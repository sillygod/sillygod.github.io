<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="sillygod, jing blog, jing github" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="I am a web developer. love python, know js, css, html and learn haskell in spare time.">
<meta property="og:type" content="website">
<meta property="og:title" content="My Travel in Programming">
<meta property="og:url" content="http://sillygod.github.io/index.html">
<meta property="og:site_name" content="My Travel in Programming">
<meta property="og:description" content="I am a web developer. love python, know js, css, html and learn haskell in spare time.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My Travel in Programming">
<meta name="twitter:description" content="I am a web developer. love python, know js, css, html and learn haskell in spare time.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://sillygod.github.io/"/>





  <title> My Travel in Programming </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">My Travel in Programming</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">hh</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2017/04/06/mithril/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/06/mithril/" itemprop="url">
                  mithril 開發官網記錄
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-06T16:05:00+00:00">
                2017-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/06/mithril/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/06/mithril/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="短期官網開發記錄"><a href="#短期官網開發記錄" class="headerlink" title="短期官網開發記錄"></a>短期官網開發記錄</h1><p>最近公司有個臨時的官網需求，想要兩個禮拜內就要出爐，聽到這麼急的需求，當下我當然是有點傻眼，因為只有我一人做，然後重點還要等設計圖，做電腦版還有手機版，跨平台的版面有時候可是很難搞的…尤其是也不是說很簡單的設計，所以其實挺趕的，因此在設計圖出來前，就先大概想像的應用情況，以下來講一下我的考量。</p>
<h2 id="library-規劃考量"><a href="#library-規劃考量" class="headerlink" title="library 規劃考量"></a>library 規劃考量</h2><p>這邊因為頁面一開始得知，設計想要做single page application，想當然我可以先決定一個主軸library來使用，這邊我是找個類似react的library來使用，為何我不用react呢？ 是有幾個考量</p>
<ol>
<li>library 大小太大</li>
<li>跟es5的js library相性不好（也就是不好結合）</li>
<li>需要搭配bundle tool</li>
</ol>
<p>基於種種考量，這裡我選擇了<a href="https://mithril.js.org/" target="_blank" rel="external">mithril js</a>，至於理由很簡單你把上面理由全都相反過來就好，再加上這個官網性質其實並沒有大型或複雜到需要用很有系統的寫法，用react就有點大材小用，個人覺得除了故意要學習用途外，每一個library都有適合他的地方，不是誰誰誰就是棒，其他都爛爛爛，轉回正題，mithril js 其實api簡單，文檔也很不錯，基本上讀完文檔她的用法你就懂了，唯一要注意的就是life cycle的beforeremove method，這個後面的地雷區會提到！</p>
<p>再來這邊我想到了多語系問題，之前我都是用django的i18n，但是這次由於頁面是用js來渲染的，所以我把i18n相關的功能也讓前端負責，我用的套件是<a href="http://i18next.com/" target="_blank" rel="external">i18next</a>，使用方法很多這邊就不多介紹了ＸＤ  很方便的是你可以直接把把內容寫在js裡，包在json格式就好，後來隨著設計慢慢有想法後，需求也漸漸明朗，考慮到部份動畫需求所以就用到了svg，這裡相關套件是<a href="http://snapsvg.io/" target="_blank" rel="external">snap svg</a>，再來就是頁面滑動效果是整頁一頁一頁捲動，直接給你們看我是用什麼套件就知道我想要表達什麼，我用到的是<a href="http://alvarotrigo.com/fullPage/" target="_blank" rel="external">fullpage js</a>,這個library的start數會那麼高，其實也不是沒理由，真的寫得不錯，接口留得不錯，很好用，最後考量到根據平台不同（手機或電腦）我需要渲染不同的html組件，因此我需要一個偵測user agent的library，這邊我是用到<a href="https://hgoebl.github.io/mobile-detect.js/" target="_blank" rel="external">mobile detect js</a>，這邊總結一下我用到的主要library有哪些：</p>
<ul>
<li><a href="https://mithril.js.org/" target="_blank" rel="external">mithril js</a></li>
<li><a href="http://i18next.com/" target="_blank" rel="external">i18next</a></li>
<li><a href="http://snapsvg.io/" target="_blank" rel="external">snap svg</a></li>
<li><a href="http://alvarotrigo.com/fullPage/" target="_blank" rel="external">fullpage js</a></li>
<li><a href="https://hgoebl.github.io/mobile-detect.js/" target="_blank" rel="external">mobile detect js</a></li>
</ul>
<p>從這邊可以發現有許多lib都是用es5寫法吧，mithril js他是可以用es5和es6寫法的，這也是我選擇他的主因，當然他的渲染效率也是頗高，或許有人會說他不需要用套件自己都可以寫，當然拉，全部任何東西都可以自己寫啊～ 包括react你也自己寫一個給我看看，在兩個禮拜內，從前面這邊看到重點了嗎？ 期限！！ 許多東西都是基於時間而有所考量和採取應變措施，可以跟你說實際上我寫官網的時間只有八天，就得上線囉，後面會講到時間分佈。</p>
<h3 id="套件研究"><a href="#套件研究" class="headerlink" title="套件研究"></a>套件研究</h3><p>關於套件的研究，其實大致上我都是先看文檔，與這個open source community活耀度，來決定是否使用它，裡面大概只有svg我是直接看網路上教學文較多的來選擇，因為svg我之前沒用過ＸＤ 只有看看文章的了解程度而已，所以想藉由教學來快速上手，剩餘我上面列的套件，其實都挺簡單的，建議各位可以簡單寫寫東西，看看library是否和各位客官的口味再決定是否使用喔。</p>
<h2 id="實際開發"><a href="#實際開發" class="headerlink" title="實際開發"></a>實際開發</h2><p>再來就講講我實際上開發時遇到的問題，也就是我事前沒想過遇到的事情，其實正常下都一定會發生意料之外的事情拉，所以建議預估時程最好留個幾天用來應付意外的，還有保留一些事後修修改改的時間囉，因為頁面做出來後，是有可能會被要求那可不可以怎樣怎樣的，下面就來講講主要遇到的地雷 :p</p>
<h3 id="遇到地雷及瓶頸"><a href="#遇到地雷及瓶頸" class="headerlink" title="遇到地雷及瓶頸"></a>遇到地雷及瓶頸</h3><p>第一要來講的就是svg! Oh my godness！ 他讓我耗費最多時間，因為設計師用AI產生的svg檔，跟他用ＡＩ上所看到的，實際上有所出入，我這邊是不知道為啥他弄出來後，少了好多好多的漸層和透明效果，我花了一些時間研究，有線索提出可能是svg內容產出的時候沒有把 <code>mask</code> <code>linear gradient</code> 等等放入，<code>def</code>裡面，因此..我抱著一線希望手動把上千行的svg內容整理，呼呼～ 這邊實在是幸好 spacemacs 對於文字編輯的好用，讓我省了一些時間，但是我也花了一整天在整理… 整理完之後，的確部分效果有出來了！ 但是還是有些效果沒有出現..於是乎，我自己手動加上那些效果，參數也是自己猜，才幾乎還原到85%的樣子，總結上，光是讓svg正常顯示我就花了兩天時間，開發時程有八天兩天就噴掉了。</p>
<p>關於mithril js的life cycle的<code>onbeforeremove</code>這個方法，一開始我卡了半天，他竟然意外的難以觸發，官方說法是<code>Note that the onbeforeremove hook only fires on the element that loses its parentNode when an element gets detached from the DOM</code>其實這句我有看沒懂ＸＤ，最後我看github issue有點說，建議你的元素一定要被包在array裏，然後…就真的成功了，天殺的超難觸發的，另外這套件網路上的教學其實可以不用看，因為都有點過時了，建議直接看文檔就好～</p>
<p>其實我在整理svg的時候就有考慮是否放棄改成用切圖，然後展現動畫效果，可是能夠做的還是比svg少很多，但是基於我想學點東西的心態，其實我還是努力的去弄ＸＤ 畢竟這也是我離職前被託付的工作，也希望動畫效果能夠好些，而且responsive效果也不賴，畢竟svg自己就會去縮放了，但是事情沒有到這邊就為止，之後我使用了svg snap這個套件，遇到了天殺的問題.. </p>
<h4 id="svg-snap"><a href="#svg-snap" class="headerlink" title="svg snap"></a>svg snap</h4><p>一開始我有在教學網站試玩了snap，想說還算挺好用的，也大概玩出點心得，可是就當我開始去下載官方最新版snap 0.5.x ，開始開發專案，發現莫名的，我是動畫位置總會莫名偏移，這邊我就直說了，我花了半天..終於發現這是一個超大bug，像是你想要旋轉一個長方形360度，這樣簡單的功能就會爆掉了，他的中心點會無故地亂跑，我看到github上面已經有人發出issue，個人建議是如果你想用的話，就先使用0.4.x版的吧，這版你會用得比較快樂，但是由於遇到這些種種地雷，svg動畫方面我就先暫時擱置了，轉而先把版面先弄好再說，因為畢竟可是有電腦版和手機版，而且就算是電腦版也有不同螢幕尺寸問題，需要一定時間去調整。</p>
<h4 id="responsive"><a href="#responsive" class="headerlink" title="responsive"></a>responsive</h4><p>基本上這邊遇到的不同手機顯示會有點差異的問題會比較大，就算一樣是google chrome，但是在iphone和在android顯示就是會有不同，這邊我個人其實就是換不同的css寫法，達到一樣的排版效果試試看，切記開發者工具的介面只能參考參考，一切還是以實體機為主，畢竟開發工具的模擬無法完全正確，這裡主要我遇到有一個神奇的bug？ 應該說個人猜測是瀏覽器解釋行為不同，<a href="http://www.lbstek.com/en/combinator/" target="_blank" rel="external">用手機看這網站</a>，原本右上角漢堡排，是要過一段時間才會突然從畫面右邊跑進來，一個很怪的現象，但是iphone卻除了這個以外，我的header做邊ＬＯＧＯ卻整個往上移跑版了，一直找不到原因，但是過了一天後，我卻突然靈光一閃，想到是不是我那個漢堡排從右邊影響到了ＬＯＧＯ排板，經過各種分析後，我看到唯一的盲點是，我的header width是用 100%，我以為body的100%是螢幕所視範圍，但是iphone的表現行為讓我感覺body的width是變動的，個人猜測是我寫的動畫內容有擠到，所以我就把width改成 100 vw，竟然就真的解決了這個問題，但是我不知道為啥android上面原本就是正常，然後這個專案我有故意一直用flex來進行排版，感覺flex支援性已經很不錯了，反而有些用flex來排效果還比較好，相較之下反而用 ％ 好像還比較容易有神奇bug。</p>
<p>另外對於fullpage這個套件，因為手機browser有個討厭的地方，就是你只要往上滑後，瀏覽器的header就會自動隱藏，但是fullpage其實在一開始的時候就會自動計算寫死，每頁的高度，當瀏覽器header自動隱藏後，就會發現高度沒有滿版… 關於這邊我只好使用比較髒的手法， <code>height: 100vh !important</code>，強制覆寫掉inline style。</p>
<h4 id="退而求其次"><a href="#退而求其次" class="headerlink" title="退而求其次"></a>退而求其次</h4><p>基本上各平台版面調完後，我也大概預料到應該就到deadline了，事實上也的確如此，因此svg動畫那邊，我就沒有特別花時間去設計了，畢竟那邊若要講求一點，可能也要弄掉一天的時間，加上在手機是另外一種呈現，才讓我覺得動畫部分就先暫時擱置，感覺做專案趕時程就是這樣囉，原則上當然以能夠做越多為優先，但是也要量力而為，能夠做出來的就要有品質保證，而不是每個都隨便做都保證有做出來。</p>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>其實我主力於後端，前端我也只是拿我其他程式語言的背後實力，過來騙吃騙喝，哈哈！ 對於css算是摸了不少屬性和特性，但是對於怎麼寫個好結構的css目前尚未有個結論，js方面其實這個專案我並沒有用什麼架構，畢竟沒多複雜，但是其實若時間上允許的話，我建議各位是可以多用用pure js拉，瀏覽器已經越來越支援了，除非你想要支援ie8…那種，你可以看看<a href="https://github.com/oneuijs/You-Dont-Need-jQuery" target="_blank" rel="external">不需要jQuery</a>，我大學是個jquery愛好者，因為跨瀏覽器實在太好用。</p>
<p>要是時間充裕下我個人會偏好使用es6 + mithirl js + i18next，剩下功能就手動來吧ＸＤ 只是我只能說很多很多時候，由於時間因素必須有所抉擇，react真的有點過於肥大…當然往後時代網路越來越快的情況下，可能也不算什麼了吧ＸＤ，至於svg好用的js套件，snap我不知道該不該建議，他問題不少，除了最新版本(0.5.0)那個超大bug外，還有個cpu 100%的問題，效能吃很兇，這邊或許該找找其他library來替代，不過等我之後想對於svg有更深入的研究會再來寫個部落格，這篇就大概記錄到此囉，重點部分都大概列出來了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2017/03/10/mithril-experience/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/10/mithril-experience/" itemprop="url">
                  Mithril 體驗
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-10T15:31:00+00:00">
                2017-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/10/mithril-experience/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/03/10/mithril-experience/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mithril-體驗"><a href="#Mithril-體驗" class="headerlink" title="Mithril 體驗"></a>Mithril 體驗</h1><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>Ｍithril 是個輕量的javascript library，相較於react, vue使用起來更加簡單，官方文檔也算是寫的簡單易懂，首先來個最簡單的示範</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> p = <span class="built_in">document</span>.createElment(<span class="string">"p"</span>);</div><div class="line">p.textContent = <span class="string">"Hello World!"</span>;</div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"output1"</span>).appendChild(p);</div></pre></td></tr></table></figure>
<p>這個在mithril會相當於下面語法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> p = m(<span class="string">"p"</span>, <span class="string">"Hello Middle-earth!"</span>);</div><div class="line">m.render(<span class="built_in">document</span>.getElementById(<span class="string">"output2"</span>), p);</div></pre></td></tr></table></figure>
<p>m()會創造virtual HTML elements, m.render()將會把virtual dom轉換成real dom，這基本上和react是有著差不多的性質的，但是通常會使用component的方式，component就是一個javascript notation object，就是一個plain object，render會去抓view property，下面示範</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> dog = &#123;</div><div class="line">  <span class="attr">view</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> say = <span class="string">"wong"</span>;</div><div class="line">    <span class="keyword">return</span> m(<span class="string">"p"</span>, say);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">m.mount(<span class="built_in">document</span>.getElementById(<span class="string">"output3"</span>), dog);</div></pre></td></tr></table></figure>
<p>像上面使用<code>m.mount</code>不用自己在額外呼叫<code>m.render</code>這個方法，另外<code>m.mount</code>參數是接受component，<code>m.render</code>則是需要vnode。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> default_value = <span class="string">"default"</span>;</div><div class="line"><span class="keyword">var</span> input_hidden = <span class="literal">false</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">change_saying</span>(<span class="params">s</span>) </span>&#123; default_value = s; &#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggle_saying</span>(<span class="params"></span>) </span>&#123; input_hidden = !input_hidden; &#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> awesome_test = &#123;</div><div class="line">  <span class="attr">view</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> m(<span class="string">'div'</span>, [</div><div class="line">             m(<span class="string">'button'</span>, &#123;<span class="attr">onclick</span>: toggle_saying&#125;, <span class="string">'toggle saying'</span>),</div><div class="line">             m(<span class="string">'hr'</span>),</div><div class="line">             input_hidden ? <span class="literal">null</span> : </div><div class="line">             m(<span class="string">'input'</span>, &#123;</div><div class="line">               <span class="attr">onchange</span>: m.withAttr(<span class="string">'value'</span>, change_saying),</div><div class="line">               <span class="attr">value</span>: default_value</div><div class="line">             &#125;),</div><div class="line">           ]);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">m.mount(<span class="built_in">document</span>.getElementById(<span class="string">'container'</span>), awesome_test);</div></pre></td></tr></table></figure>
<p>上面這範例值得注意的地方是，<code>m.withAttr</code>這個方法，他在input onchange時，會把其當下value傳入function裡面，所以你在執行範例會看到就算你切換掉input時，他裡面得值會依然保留，因為他在他被毀掉時之前就把值存起來了，下一次被創造就使用它，你可以試試看把onchange那行砍掉，在試著切換掉input，是不是永遠一旦切換回來input裡面的值都是default。</p>
<p>接著來看看呼叫api，並且得到回傳值後，rerender</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> url = <span class="string">"http://ratfactor.com/misc/lotr-fellowship.json.php"</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Fellowship = &#123;</div><div class="line">     <span class="attr">res</span>: <span class="literal">null</span>,</div><div class="line">     <span class="attr">data</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</div><div class="line"></div><div class="line">         <span class="keyword">if</span>(res)&#123;</div><div class="line">             Fellowship.res = res;</div><div class="line">         &#125;<span class="keyword">else</span>&#123;</div><div class="line">             <span class="keyword">return</span> Fellowship.res;</div><div class="line">         &#125;</div><div class="line">     &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_fellowship</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	m.request(&#123;<span class="attr">method</span>: <span class="string">"GET"</span>, <span class="attr">url</span>: url&#125;)</div><div class="line">	 .then(Fellowship.data);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">view_fellowship</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'enter view_fellowship'</span>);</div><div class="line">	<span class="keyword">if</span> (!Fellowship.data()) &#123;</div><div class="line">		<span class="keyword">return</span> m(<span class="string">"p"</span>, <span class="string">"Click the button and wait."</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> m(<span class="string">"p"</span>, Fellowship.data().description);</div><div class="line">&#125;</div><div class="line"></div><div class="line">Fellowship.view = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> m(<span class="string">"div"</span>, [</div><div class="line">		m(<span class="string">"h3"</span>, <span class="string">"The Fellowship of the Ring"</span>),</div><div class="line">		m(<span class="string">"button"</span>, &#123;<span class="attr">onclick</span>: get_fellowship&#125;, <span class="string">"Load Fellowship"</span>),</div><div class="line">		view_fellowship(),</div><div class="line">	]);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">m.mount(<span class="built_in">document</span>.getElementById(<span class="string">'container'</span>), Fellowship);</div></pre></td></tr></table></figure>
<p>api呼叫完後，畫面會更新主要是因為，<code>m.request</code>結束後會呼叫redraw，到目前為止其實大致上概念都跟react小像，接下來回頭從整個mithril架構來開始觀看。</p>
<h3 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h3><p>其實也不該說是架構，應該要說是特性吧，畢竟他也沒有強制說要你使用哪種寫法，寫起來十分自由呢，官方文檔的<code>key concepts</code>那邊大概列了下面幾項</p>
<ul>
<li>Vnodes</li>
<li>Components</li>
<li>Lifecycle method</li>
<li>Keys</li>
<li>Autoredraw system</li>
</ul>
<h4 id="Vnodes"><a href="#Vnodes" class="headerlink" title="Vnodes"></a>Vnodes</h4><p>就是指virtual dom，這邊效率會好的重點是，dom的修改所花費的效能，其實不如直接重新創造還比較好，當然mithril自己說他有改良virtual dom演算法讓他效率更高這邊，這邊我就沒特別往裡面看了，畢竟演算法不是目前要注意的重點</p>
<p><strong>vnode types</strong></p>
<ol>
<li>Element</li>
<li>Fragment</li>
<li>Text</li>
<li>Trusted HTML</li>
<li>Component</li>
</ol>
<h4 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h4><p>如同前面所用到的，就像下面示範的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> Example = &#123;</div><div class="line">  <span class="attr">view</span>: <span class="function"><span class="keyword">function</span>(<span class="params">vnode</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> m(<span class="string">'div'</span>, <span class="string">'hello'</span>+ vnode.attr.name)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 這是一個component，跟react一樣我們也是可以傳入參數讓他去展現，</span></div><div class="line"><span class="comment">// 因此上面才會用vnode這個東西</span></div><div class="line"></div><div class="line">m(Example, &#123;<span class="attr">name</span>: <span class="string">"king"</span>&#125;)</div></pre></td></tr></table></figure>
<p>另外他跟react一樣也是擁有所謂的lifecycle，畢竟就是一個創造破壞dom的概念我想有lifecycle也是很正常吧～ </p>
<h4 id="Lifecycle-methods"><a href="#Lifecycle-methods" class="headerlink" title="Lifecycle methods"></a>Lifecycle methods</h4><h4 id="Keys"><a href="#Keys" class="headerlink" title="Keys"></a>Keys</h4><p>是一門技術用來將序列節點裡面的dom元素重新定序，並且將特定資料項目對應到相對應的dom元素序列，簡單的說這個keys就是用來讓virtual dom技術可以知道什麼資料對應哪個virtual dom元素。</p>
<p>就拿官網的例子來看，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> people = [</div><div class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"jax"</span>&#125;,</div><div class="line">  &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">"janna"</span>&#125;,</div><div class="line">]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">userList</span>(<span class="params">users</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="keyword">function</span>(<span class="params">u</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> m(<span class="string">'button'</span>, u.name);</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 這將會產生</span></div><div class="line"><span class="comment">// &lt;button&gt;jax&lt;/button&gt;</span></div><div class="line"><span class="comment">// &lt;button&gt;janna&lt;/button&gt;</span></div></pre></td></tr></table></figure>
<p>那麼今天people變成 <code>[{id:2, name:&#39;god&#39;}]</code>，render就會變成 <code>&lt;button&gt;god&lt;/button&gt;</code>，那麼對於virtual dom演算，他會不知道要怎麼辦，因為有兩種可能，一個是第二的button被刪掉或是第一個button被刪掉，然後再改變其text的值，然後就會發生可怕的事，他自有自己的演算法去決定要怎麼下去，但是萬一今天你的button上面有綁事件怎辦？ 你無法確定哪個button是被留下來的，就會產生錯誤，因此這也是為啥要有keys的原因，所以上面應該要修改成如下，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">return</span> m(<span class="string">'button'</span>, &#123;<span class="attr">key</span>: u.id&#125;, u.name);</div></pre></td></tr></table></figure>
<h4 id="Autoredraw-system"><a href="#Autoredraw-system" class="headerlink" title="Autoredraw system"></a>Autoredraw system</h4><p>其實就是rerender的機制，在<code>m.mount</code>, <code>m.route</code>這兩個上面有相關機制存在，<code>m.render</code>沒有，以component為例，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> MyComponent = &#123;</div><div class="line">  <span class="attr">view</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> m(<span class="string">'div'</span>, &#123;<span class="attr">onclick</span>: doSomething&#125;); </div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">  <span class="comment">// 這邊將會產生rerender，如果doSomething被呼叫後</span></div><div class="line">  <span class="comment">// 如果你不想產生rerender，可以</span></div><div class="line">  <span class="comment">// e.redraw = false</span></div><div class="line">  <span class="comment">// 這樣就不會rerender了</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>m.request呼叫完畢也是會造成rerender，跟上面一樣他也有設定可以讓他不redraw</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">m.request(<span class="string">"/example/api"</span>, &#123;<span class="attr">background</span>: <span class="literal">true</span>&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>最後route change也會造成redraw。</p>
<h3 id="To-sum-up"><a href="#To-sum-up" class="headerlink" title="To sum up"></a>To sum up</h3><p>整體而言，我覺得是可以嘗試一下這個library，因為他的自由性，個人目前有意思想把之前用angularjs寫的專案改成用這套寫寫看，不用react是因為，相對起來這套需要變動的地方比較少，他不像react通常還要搭配一些bundle tool還有架構性的framework才會比較完整，mithril js就是一個小而巧的library，可能也可以算是framework了，之後等我試用了一段時間後，有更多心得會再另外寫blog。</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>一些靈感和內容來自於下面部落格參考，寫得很詳盡清晰</p>
<ol>
<li><a href="http://ratfactor.com/mithril1.html?/shire" target="_blank" rel="external">blog ref1</a></li>
<li><a href="http://ratfactor.com/mithril2.html" target="_blank" rel="external">blgo ref2</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2017/02/28/-functional-programming-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/28/-functional-programming-python/" itemprop="url">
                  閱讀 Functional Programming Python 心得
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T13:58:00+00:00">
                2017-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/functional/" itemprop="url" rel="index">
                    <span itemprop="name">functional</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/28/-functional-programming-python/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/02/28/-functional-programming-python/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="閱讀-Functional-Programming-Python-心得"><a href="#閱讀-Functional-Programming-Python-心得" class="headerlink" title="閱讀 Functional Programming Python 心得"></a>閱讀 Functional Programming Python 心得</h1><h2 id="何謂-functional-programming"><a href="#何謂-functional-programming" class="headerlink" title="何謂 functional programming"></a>何謂 functional programming</h2><p>通常是指程式語言具有以下特性</p>
<ol>
<li>function 是 first class object</li>
</ol>
<p>意思就是 function 可以像 data(例:Ｃ語言的變數) 一般，可以被當作函式的參數傳入，也可以當作回傳值被回傳，或是被賦予到某變數，甚至是存到資料結構，</p>
<ol>
<li><p>遞迴是基本中的基本流程結構，甚至有些程式語言是沒有所謂的迴圈</p>
</li>
<li><p>higher order function</p>
</li>
</ol>
<p>這是指function被當作另外一個function的參數或是將function當作回傳結果</p>
<ol>
<li>程式語言結構沒有所謂的statements 只有 expression</li>
</ol>
<p>這個像是haskell就是這樣</p>
<ol>
<li>pure functional language 是沒有 side effects</li>
</ol>
<p>所謂的side effects是指，你的function，只要你每次的呼叫都是帶入同樣的參數，就會得到相同的結果</p>
<p>相信稍微熟悉python的人，看了上述就知道python其實也多多少少算是functional programming有點沾到邊，不得不說python就是一個這樣的語言，他並沒有強制要成為某種特定形式的語言，像是Ojbect oriented language，或是像Ｃ那種imperative language，甚至是functional language，所以這讓python在寫程式的時候有著很大的自由呢～</p>
<h3 id="相關閱讀資源"><a href="#相關閱讀資源" class="headerlink" title="相關閱讀資源"></a>相關閱讀資源</h3><p>書中有提到一些資源，這邊做點記錄</p>
<ol>
<li><a href="https://docs.python.org/3.5/howto/functional.html" target="_blank" rel="external">python 官網</a></li>
</ol>
<p>沒想到官網竟然就有一篇好教學</p>
<ol>
<li><a href="https://www.ibm.com/developerworks/linux/library/l-prog/index.html" target="_blank" rel="external">ibm developer works</a></li>
</ol>
<p>太久沒到這網站了，沒想到ui整個都改變了，這上面其實有不少教學文不錯，可以多看看</p>
<ol>
<li><a href="https://github.com/sfermigier/awesome-functional-python" target="_blank" rel="external">awesome functional python</a></li>
</ol>
<hr>
<h2 id="functional-programming-思維"><a href="#functional-programming-思維" class="headerlink" title="functional programming 思維"></a>functional programming 思維</h2><h3 id="how-to-what"><a href="#how-to-what" class="headerlink" title="how to what"></a>how to what</h3><p>書中所提到的是functional programming，比起imperative programming，更加著重於 what，感覺上就是指，函式裡面是如何產生結果的這邊不用去理解，你只要知道你丟什麼東西，會產生生什麼東西就好，其實就是一種細節隱藏的概念，以下引用書中範例:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">collection = get_initial_state() </div><div class="line">state_var = <span class="keyword">None</span></div><div class="line"><span class="keyword">for</span> datum <span class="keyword">in</span> data_set:</div><div class="line">    <span class="keyword">if</span> condition(state_var):</div><div class="line">        state_var = calculate_from(datum) </div><div class="line">        new = modify(datum, state_var) </div><div class="line">        collection.add_to(new)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        new = modify_differently(datum) collection.add_to(new)</div><div class="line"></div><div class="line"><span class="comment"># Now actually work with the data</span></div><div class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> collection: </div><div class="line">    process(thing)</div></pre></td></tr></table></figure>
<p>上面程式就是典型的imperative思維，一行一行的指令執行，從獲得初始資料，資料剖析處理整理出你要的資料<br>，最後才真正地對資料去做要做的事情，再來看看functional programming思維是怎麼樣</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_collection</span><span class="params">(data_set)</span>:</span> </div><div class="line">    collection = get_initial_state() </div><div class="line">    state_var = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> datum <span class="keyword">in</span> data_set:</div><div class="line">        <span class="keyword">if</span> condition(state_var):</div><div class="line">            state_var = calculate_from(datum, state_var) </div><div class="line">            new = modify(datum, state_var) </div><div class="line">            collection.add_to(new)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            new = modify_differently(datum)</div><div class="line">            collection.add_to(new)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> collection</div><div class="line"></div><div class="line"><span class="comment"># Now actually work with the data</span></div><div class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> make_collection(data_set): </div><div class="line">    process(thing)</div></pre></td></tr></table></figure>
<p>程式碼幾乎沒啥改變，就只是單純多了一層抽象化包裝，但是這要表達什麼？ 就是我們可以不用去注重make_collection裡面到底是如何做的，我們只要知道餵它吃什麼，它就會吐出什麼XD ， 對於書中最後面 for 迴圈如果想要更佳functional思維的話，我個人覺得可以改成 <code>[process(thing) for thing in make_collection(data_set)]</code> 當然前提是process(thing) 是有要回傳資料的話～</p>
<p>這種思維對於unit test也是比較易於測試的，因爲測試本身就是一個你給它資料，然後你期待得到什麼回傳結果的行為，剛剛好等於functional思維。</p>
<h3 id="遞迴"><a href="#遞迴" class="headerlink" title="遞迴"></a>遞迴</h3><p>我想這是絕對最最最基本的程式流程，不會用到loop，對於python而言，遞迴是非常沒有效率的，而且有最大遞迴次數限制</p>
<p><img src="http://i.imgur.com/2NqXm1T.png" alt="compare recursive and iterative"></p>
<p>上圖雖然我用的數字不大（因為試過隨便帶個1000，遞迴版本就爆掉拉），可以看出迴圈執行效率是比較高的，其實照理說一般是會對所謂的tial-recursion做編譯優化讓他等於迴圈，但是python並沒有做這種處理，因此這也讓我對python是否適合拿來學習functional programming感到一點遲疑，這也是為何我會好奇讀這本書的原因，然後有一點讓我挺驚訝的是，沒想到用reduce的效率會比迴圈高，真是不知道python的reduce裡面做了什麼，雖然說使用了<code>dis</code>模組看了一下解譯後的指令，的確是挺少的拉，但是這不能代表效率，我想如果想要知道為何效率比較高的話，可能得去研究python的source code了。</p>
<h3 id="Closure-and-callable-instance"><a href="#Closure-and-callable-instance" class="headerlink" title="Closure and callable instance"></a>Closure and callable instance</h3><p>書中有個說法十分有趣，如果是資工系相關出身的人大概都有聽過class is data with oprations attached 之類的說法吧，但是對於closure呢？ closure is operations with data attached. 這句真是有醍醐灌頂之效，我真的沒這樣想過，以下舉例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adder</span>:</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></div><div class="line">    self.n = n</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__call_</span><span class="params">(self, m)</span>:</span></div><div class="line">    <span class="keyword">return</span> self.n + m</div><div class="line">    </div><div class="line">add5 = Adder(<span class="number">5</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_adder</span><span class="params">(n)</span>:</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">adder</span><span class="params">(m)</span>:</span></div><div class="line">    <span class="keyword">return</span> m + n</div><div class="line">  <span class="keyword">return</span> adder</div><div class="line">  </div><div class="line">add5 = make_adder(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p>上面class版本只是示範，如何使用class來實作類似效果而已，那麼看看這個跟以前物件導向有哪裡不同，以前物件導向，就是初始化實例，然後他本身會有定義相對應動作，在呼叫去執行，所以就是class is data with operations attached，那麼今天這個class Adder則是已經先把行為給定義好了，剩下餵資料而已，就像是<code>add5(10)</code>就會得到15，這就是closure is operations with data attached 想要表明的意思。</p>
<p>執得注意的地方是python的closure，他的variable是bind by name而不是value，以下舉例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">test_case = [<span class="keyword">lambda</span>: i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</div><div class="line"></div><div class="line">print(test_case[<span class="number">0</span>]())</div><div class="line">print(test_case[<span class="number">1</span>]())</div></pre></td></tr></table></figure>
<p>沒意外的話你會看到兩個都是4，會這樣的原因是lambda: i 相當於 return i的意思，那麼這個i就是for迴圈的i，當for 迴圈結束時，i值等於4，所以由此可以知道python的closure變數只是做一個類似指標指過去的概念，所以如果你想要讓裡面的i值是每一次的for迴圈值那麼你就要用python會對function的parameter做初始化的動作那邊下手，如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">test_caes = [<span class="keyword">lambda</span> i=i: i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</div><div class="line"></div><div class="line">print(test_case[<span class="number">0</span>]())</div><div class="line">print(test_case[<span class="number">1</span>]())</div></pre></td></tr></table></figure>
<p>這樣你就會看到你想要的結果拉～</p>
<h3 id="lazy-evaluation"><a href="#lazy-evaluation" class="headerlink" title="lazy evaluation"></a>lazy evaluation</h3><p>這個在函式語言可是非常常見，簡單說就是遇到了才做動作的意思，比方說像我想要建立一個無限的陣列，聽起來很詭異吧，但是在haskell之類的functional programming卻是很正常的東西，因為他們本身就是lazy evaluation，需要從那陣列拿多少東西再拿，而不是一開始就先定義好一個內容無限長的陣列，在傳統的Ｃ語言，想必大家都習慣，new array，collect需要的記憶體這些動作了吧，哪來的無限哈哈～</p>
<p>在python中，要如何建立這種概念的東西，答案就是要使用iterator，其中最常使用的方式是，generator，應該很常看到在funtion裡面有<code>yield</code>吧，那就是generator，在python概念，會比較跟c++不太一樣，c++是有分container和iterator，iterator就是一個純粹的指標，指向container，然後可以存取東西這樣，可是python的iterator，感覺就比較像是兩者融合了，以下面範例來看</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">infinite_ary</span><span class="params">()</span>:</span></div><div class="line">    n = <span class="number">1</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        <span class="keyword">yield</span> n </div><div class="line">        n += <span class="number">1</span></div></pre></td></tr></table></figure>
<p>PEP定義片段是這樣描述的 The iterator provides a ‘get next value’ operation that produces the next item in the sequence each time it is called，基本上就是有實作 <strong>next</strong> 這個magic method，讓他可以取得下一個值的都算是iterator，所以這麼看來上面這個function同時算是container和iterator的結合，但是其實也不能算是container拉，因為它實際背後也沒有真的去做收集資料，而是前面所講的lazy evaluation，然後最後還是回傳給你iterator讓你操作拉～ 其實用起來滿簡潔的，這也是為用了python回不去c++的原因，語法實在是太簡潔漂亮，反觀c++越來越…四不像了，也複雜的恐怖，已經好久沒碰c++了啊，哈哈哈</p>
<h3 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h3><p>書中提到python內建模組中functool的partial，就是currying，我覺得這句有點不那麼精準，根據<a href="https://wiki.haskell.org/Currying" target="_blank" rel="external">haskell 官網</a>的定義，然後這是<a href="https://wiki.haskell.org/Partial_application" target="_blank" rel="external">partial的定義</a>，partial是指能夠傳入比函式定義少的參數的能力，以下舉例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></div><div class="line">    <span class="keyword">return</span> x+y</div><div class="line"></div><div class="line"></div><div class="line">addOne = partial(add, <span class="number">1</span>)</div><div class="line">addOne(<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>上面結果會是3，在haskell中，並不需要特別像python一樣，還要import functools中的partial，這是haskell基本特性，add函式本身定義是需要兩個參數，但是卻可以利用partial，給予少於兩個參數，並且得到addOne這個函式，然後我呼叫他，這個行為就是partial (apply)，但是我這個舉例剛剛好也符合currying，接著讓我們來看currying定義是什麼，根據官方定義是，將擁有多參數的函式，變成只接受一個參數，如果還有其他參數，就回傳另外一個函式</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="title">g</span>: (a, b) -&gt; c</div><div class="line"></div><div class="line">;; curried 後</div><div class="line"></div><div class="line"><span class="title">f</span>: a -&gt; b -&gt; c</div></pre></td></tr></table></figure>
<p>上面是用haskell表示curry的概念，根據這定義我們前面python所寫的，也剛好符合，但是這不代表python實作的partial等於currying，因為今天我們要是給予兩個以上參數，或是任何地方跟定義不一樣，就會變成不是currying，所以應該是這樣說的，currying是partial的子集，我們可以利用partial達到currying的效果這樣。</p>
<hr>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>後半部書中，大致上都是在講python內建的，functools, itertools，確實使用起來挺方便的，也讓我反省了一下，是否以後在工作有些地方可以使用看看，先姑且不論效率上是否會更好，程式碼簡潔程度會有大大的提升，然後對於python來學習functional programming style，如果是以學習來講的話，我個人覺得不是那麼好，最好還是學haskell這種pure functional programming，會學的比較多和深，雖然我自己也還沒學特別深拉ＸＸＤ。 但是python是可以用functional progamming style是無庸置疑的，而且老實講語意上也是很順，之後如果有時間我想我會好好想想怎麼用python來用functional programming的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2017/02/18/1429759/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/18/1429759/" itemprop="url">
                  閱讀 20 Python Libraries You Aren't Using (But Should) 心得
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-18T08:57:00+00:00">
                2017-02-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/18/1429759/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/02/18/1429759/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="閱讀-20-Python-Libraries-You-Aren’t-Using-But-Should-心得"><a href="#閱讀-20-Python-Libraries-You-Aren’t-Using-But-Should-心得" class="headerlink" title="閱讀 20 Python Libraries You Aren’t Using (But Should) 心得"></a>閱讀 20 Python Libraries You Aren’t Using (But Should) 心得</h1><p>此書是oreilly <a href="http://www.oreilly.com/programming/free/20-python-libraries-you-arent-using-but-should.csp" target="_blank" rel="external">提供的免費書</a>，上面還有許多免費的書，有興趣的人就自行去觀賞一下。 這本書如題主要是要講一些好用但較不常聽到或是被你忽略的library，首先以standard library切入，其實python built-in library 實在太豐富了，我想其實很多人連一半的模組可能都沒用到呢～ 以下開始介紹</p>
<h2 id="Standard-libraries"><a href="#Standard-libraries" class="headerlink" title="Standard libraries"></a>Standard libraries</h2><p>下面記錄一些</p>
<h3 id="collections"><a href="#collections" class="headerlink" title="collections"></a>collections</h3><h4 id="collections-OrderedDict"><a href="#collections-OrderedDict" class="headerlink" title="collections.OrderedDict"></a>collections.OrderedDict</h4><p>python的其中之一data type <strong>dict</strong>，dict是不會保持順序的，也就是說你去traverse他，順序是不一定的，但是相信有時候在寫程式時會有需求是要用特定順序去探訪資料，這也是為啥<strong>OrderedDict</strong>會出現，下面給個範例。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> string</div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</div><div class="line"></div><div class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> zip(string.ascii_lowercase, range(<span class="number">5</span>))]</div><div class="line"></div><div class="line"><span class="comment"># 為了要看出dict是不會保持順序的，這邊我們故意用dict在包裝zip的內容</span></div><div class="line"><span class="comment"># 你可以試著比較下面兩個輸出結果</span></div><div class="line"></div><div class="line">dict(zip(string.ascii_lowercase, range(<span class="number">7</span>)))</div><div class="line">OrderedDict(zip(string.ascii_lowercase, range(<span class="number">7</span>)))</div><div class="line"></div><div class="line"><span class="comment"># 將會發現 OrderedDict 仍然保持著順序，OrderedDcit保持的是一開始的順序</span></div><div class="line"><span class="comment"># 也就是traverse遇到的順序 a, b, c, d, e ，ouput時就是會依照這順序</span></div></pre></td></tr></table></figure>
<p>這個library實用性挺高的，我個人在工作上偶爾都會用到，需要詳細了解的他整個功能其實建議直接看他源碼實作，官方文檔介紹的比較少</p>
<h4 id="collections-defaultdict"><a href="#collections-defaultdict" class="headerlink" title="collections.defaultdict"></a>collections.defaultdict</h4><p>相信各位使用dict時會遇到常常要先檢查某key值是否在dict中，有的話就會某某動作，沒有的話就做一些類似初始的動作，下面用範例來將上面敘述變得比較容易懂</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line"></div><div class="line">s = [(<span class="string">'yellow'</span>, <span class="number">1</span>), (<span class="string">'blue'</span>, <span class="number">2</span>)]</div><div class="line">d = defaultdict(list)</div><div class="line"></div><div class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</div><div class="line">    d[k].append(v)</div></pre></td></tr></table></figure>
<p>上面將為每個dict的key所對應的值，先預設初始為空list，因此你才可以直接call append這個方法，要不然一般的方式是</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">d = &#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> k <span class="keyword">in</span> d:</div><div class="line">        d[k] = []</div><div class="line">    </div><div class="line">    d[k].append(v)</div></pre></td></tr></table></figure>
<p>這個我到是就用得比較少，實際上也只是減少你的coding數目，讓他更簡潔，要不要使用這個lib，個人覺得倒是沒有那麼大必要性</p>
<h4 id="collections-nametuple"><a href="#collections-nametuple" class="headerlink" title="collections.nametuple"></a>collections.nametuple</h4><p>哈這個我想應該很多人都知道這個才對，對於程式碼可讀性，個人絕對支持一定要用namedtuple，不只是讓你自己寫程式方便，也讓別人讀你的code更好懂，以下舉例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</div><div class="line"></div><div class="line">tup = (<span class="number">1</span>, <span class="keyword">True</span>, <span class="string">"red"</span>)</div><div class="line">Spec = namedtuple(<span class="string">'Spec'</span>, <span class="string">'count enable color'</span>)</div><div class="line">tup_new = Spec(count=<span class="number">1</span>, enable=<span class="keyword">True</span>, color=<span class="string">'red'</span>)</div></pre></td></tr></table></figure>
<p>namedtuple的好處就是我不會是用magic number來存取值，像是<code>tup</code>這個tuple，想要取值就會用tup[0]去取第一個值，那麼對於<code>tup_new</code> 我就可以使用tup_new.count取得第一個值，可讀性哪個高馬上立見高下。</p>
<h3 id="contextlib"><a href="#contextlib" class="headerlink" title="contextlib"></a>contextlib</h3><p>這個主要是用於resource clean up會比較常用到，像是</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">with</span> open(<span class="string">'test.dat'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</div><div class="line">    data = f.read()</div></pre></td></tr></table></figure>
<p>使用<code>with</code>這語法後，就不用在自行呼叫f.close()，因為他會在你裡面區塊執行完畢後，自動幫你執行資源釋放，這個應該很多人都有用過，真的特別的地方是，<code>contextmanager</code></p>
<p>首先先來講講 with 後面所接的物件，這個你是可以自定義的，要自己實作class，並且實作<code>__enter__</code>，<code>__exit__</code>，詳細的可以看<a href="https://www.python.org/dev/peps/pep-0343/" target="_blank" rel="external">PEP343</a>，這邊簡單的說明一下，with這語法就是為了將try catch finally語法，做個算是更優美語意。</p>
<p>這篇提案有很多想法都是來自於pep340, pep346，經過一段修修改改後才終於討論出一個定案</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">with</span> EXPR <span class="keyword">as</span> VAR:</div><div class="line">    BLOCK</div><div class="line">    </div><div class="line"></div><div class="line">mgr = (EXPR)</div><div class="line">exit = type(mgr).__exit__</div><div class="line">value = type(mgr).__enter__(mgr)</div><div class="line">exc = <span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    VAR = value  <span class="comment"># only if "as VAR" is present</span></div><div class="line">    BLOCK</div><div class="line"><span class="keyword">except</span>:</div><div class="line"></div><div class="line">    exc = <span class="keyword">False</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exit(mgr, *sys.exc_info()):</div><div class="line">        <span class="keyword">raise</span></div><div class="line"></div><div class="line"><span class="keyword">finally</span>:</div><div class="line">    <span class="comment"># the normal and non-local-goto cases are handled here</span></div><div class="line">    <span class="keyword">if</span> exc:</div><div class="line">        exit(mgr, <span class="keyword">None</span>, <span class="keyword">None</span>, <span class="keyword">None</span>)</div></pre></td></tr></table></figure>
<p>上面列出部分pep的內容，with的語法大概等於下面那些一長串的東西，語法顯得更加簡潔吧～</p>
<p>但是這個是class層級的物件，假設你今天想要用function而已，那麼要怎麼做呢？ python contextlib，裡面所實做的 contextmanager 就是為了這個需求而生，進而跑出一些有趣的寫法～</p>
<p>這本書舉個有趣的範例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter</div><div class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</div><div class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">timing</span><span class="params">(label)</span>:</span></div><div class="line">    t0 = perf_counter()</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">lambda</span>: (label, t1-t0)</div><div class="line">    t1 = perf_counter()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">with</span> timing(<span class="string">'Array tests'</span>) <span class="keyword">as</span> total:</div><div class="line">    <span class="keyword">with</span> timing(<span class="string">'Array creation innermul'</span>) <span class="keyword">as</span> inner:</div><div class="line">        x = array(<span class="string">'d'</span>, [<span class="number">0</span>]*<span class="number">1000000</span>)</div><div class="line">        </div><div class="line">    <span class="keyword">with</span> timing(<span class="string">'Array creation outermul'</span>) <span class="keyword">as</span> outer:</div><div class="line">        x = array(<span class="string">'d'</span>, [<span class="number">0</span>]) * <span class="number">1000000</span></div><div class="line"></div><div class="line">print(<span class="string">'Total [%s]: %.6f s'</span> % total())</div><div class="line">print(<span class="string">'timing [%s]: %.6f s'</span> % inner())</div><div class="line">print(<span class="string">'timing [%s]: %.6f s'</span> % outer())</div></pre></td></tr></table></figure>
<p>上面所做的就是去計算妳函式運算花了多少時間，很方便，同時也很讓人耳目一新吧，從範例的使用方法，也大概略知contextmanager是使用python generator去實作出來的，所以使用時才會有yield這語法，這範例有個有趣的地方，就是 <code>lambda: (label, t1-t0)</code> 我一開始其實對這個地方有點不解，因為照理說當程式執行到這行時，它應該會不懂t1是什麼而報錯才對，但是事實是不會喔～ 因為程式執行到yield時就會停住，lambda 那串還不會跑喔，等到你call <code>next</code> 他才會開始繼續執行下去，至於為何要多包一層lambda，這邊就是因為t1定義是在後面，要是你不這樣多包一層，直接 <code>yield t1-t0</code> 就會錯了喔～</p>
<p>另外，<code>array</code> 這模組就是能夠創造像c語言裡面的那種array，雖然應用情況在哪我不太清楚，我真的幾乎沒啥用到這個，不過這個範例到是讓我知道對於array而已直接丟一個大list進去反而效率會比較差… 倒是讓我長知識了。</p>
<h4 id="atexit"><a href="#atexit" class="headerlink" title="atexit"></a>atexit</h4><p>在書本後面某範例有用到一個內建模組<code>atexit</code>，這個我也是沒用過，但是感覺挺新鮮的或許在某些地方可以用到，看<a href="https://docs.python.org/3/library/atexit.html" target="_blank" rel="external">官方文檔</a>，簡單說這個模組的功用是可以在你的整個程式要結束時，通常是用來作為程市意外結束時，為了避免資料遺失還是做個保存，或者是資源釋放吧，目前大概想到這些。</p>
<h1 id="Third-Party-Libraries"><a href="#Third-Party-Libraries" class="headerlink" title="Third Party Libraries"></a>Third Party Libraries</h1><p>這邊有些套件就不特別介紹了，只挑幾個個人有興趣做記錄的套件</p>
<h4 id="Fabulous"><a href="#Fabulous" class="headerlink" title="Fabulous"></a>Fabulous</h4><p>一個滿有趣的套件，讓你的開發terminal介面程式，可以更加漂亮的客製化</p>
<h4 id="Pywebview"><a href="#Pywebview" class="headerlink" title="Pywebview"></a>Pywebview</h4><p>底層應該是使用webview的引擎之類的像是webkit去渲染html,js,css，建立出原生gui元件，比起一般的gui或許會更好用，但是我個人的話，會選擇用electron，畢竟他的community比較強大，比較多人維護，不過electron就不是用python寫程式囉～～</p>
<h4 id="ptpython"><a href="#ptpython" class="headerlink" title="ptpython"></a>ptpython</h4><p>這個老實講我覺得不是那麼需要拉，如果你懶得開editor或是ide，這個可以讓你在termial的repl享受到稍稍接近ide部份功能，雖然我覺得ipython就很夠了，我還是列上來記錄一下ＸＤ</p>
<h4 id="boltons"><a href="#boltons" class="headerlink" title="boltons"></a>boltons</h4><p><a href="https://github.com/mahmoud/boltons" target="_blank" rel="external">boltons</a>算是python builtins的增強吧，不過其實python本身內建模組就已經很夠了，所以這套件個人是覺得不太有必要，但是卻是一個可以拿來學習的套件</p>
<h2 id="Cython"><a href="#Cython" class="headerlink" title="Cython"></a>Cython</h2><p>這個特別挑出來講的原因，其實也是因為我一直以來都有聽說這個但是卻沒有花時間來玩玩感受它的魔力，我另外還有耳聞過<a href="http://numba.pydata.org/" target="_blank" rel="external">numba</a>，只是這篇就先著重於cython來記錄改天再來挖時間比較這兩者差別。</p>
<p>總體上來說，他是一個算是小型語言語法上幾乎與python差不多，經過Cython interpreter會把code轉成c/c++在compile成python extension modules，來讓python使用</p>
<h3 id="安裝cython"><a href="#安裝cython" class="headerlink" title="安裝cython"></a>安裝cython</h3><p>十分簡單的安裝方式 <code>pip install Cython</code></p>
<h3 id="cython-process"><a href="#cython-process" class="headerlink" title="cython process"></a>cython process</h3><p><code>.pyx</code> file compiled by Cython to <code>.c</code> file and then <code>.c</code> file compiled by c compiler to <code>.so</code> or <code>.pyd</code> accroding to your operating system. There files can be import directly by python</p>
<p>哈，上面只是cython編譯流程，反正你只要知道<code>.pyx</code>是給cython看得就好，接著來看看官網的簡單範例。</p>
<p><code>hello.pyx</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hello_to</span><span class="params">(name)</span>:</span></div><div class="line">    print(<span class="string">"Hello %s!"</span> % name)</div></pre></td></tr></table></figure>
<p><code>setup.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup</div><div class="line"><span class="keyword">from</span> Cython.Build <span class="keyword">import</span> cythonize</div><div class="line"></div><div class="line">setup(</div><div class="line">  name = <span class="string">'Hello world app'</span>,</div><div class="line">  ext_modules = cythonize(<span class="string">"hello.pyx"</span>),</div><div class="line">)</div></pre></td></tr></table></figure>
<p>使用<code>distutils</code>來產生library檔，輸入<code>python setup.py build_ext --inplace</code>，下完指令後，就會產生library檔，之後就可以在你的py file import使用</p>
<p>ex.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">from</span> hello <span class="keyword">import</span> say_hello_to</div><div class="line">say_hello_to(<span class="string">'stranger'</span>)</div></pre></td></tr></table></figure>
<p>其實就算你不用cython也是可以達到相同作用，但是就是用c/c++的語法去寫library，或是你用swig之類的工具也可，cython需要再多多使用才知道實用程度如何，不過有一點讓我覺得不錯的是，他跟ipython有結合，其實官網範例都有示範，詳情可以去看看～</p>
<p>ipython 有分很方便的 <code>%</code> 這是執行單行command line  <code>%%</code> 這是執行整個cell的command<br>舉例你今天想要簡單分析某個程式碼所耗時間就是使用 <code>%timeit range(10000)</code> ，那麼你有很多行想要分析的話，就要使用 <code>%%</code></p>
<p>個人有用ipython寫個簡單測試cython提升效率的測試，為了要知道效果所以就用個最簡單寫法同時也是效率最不好方式實現Fibonacci數列</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></div><div class="line">    <span class="keyword">if</span> n==<span class="number">1</span> <span class="keyword">or</span> n==<span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span> n</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> factorial(n<span class="number">-1</span>)+factorial(n<span class="number">-2</span>)</div><div class="line"><span class="comment"># above version will reach the maximum recursion</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_factorial</span><span class="params">(n)</span>:</span></div><div class="line">    <span class="comment"># I think this will be much more efficient than recursive version</span></div><div class="line">    first, second = <span class="number">0</span>, <span class="number">1</span></div><div class="line">    </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        <span class="keyword">yield</span> first</div><div class="line">        first, second = second, first+second</div></pre></td></tr></table></figure>
<p>上面第一個寫法就是效率最爛的寫法，使用遞迴，原因是會造成多次重複計算，最簡單提升效率方法是，用個table記錄已算過的值，類似cache的概念，這樣效率就會大大提升，但是數字一大最終會遇到一個問題，就是遞迴次數有最大限制，會爆掉，所以我下面提供了用generator，同時也是目前個人覺得效率最好的方式，也不用怕遞迴次數上限，轉回正題，今天使用cython要來比較效率改善多少，就是要來改第一個版本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">cfactorial</span><span class="params">(int n)</span>:</span></div><div class="line">    <span class="keyword">if</span> n==<span class="number">1</span> <span class="keyword">or</span> n==<span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span> n</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> cfactorial(n<span class="number">-1</span>)+cfactorial(n<span class="number">-2</span>)</div></pre></td></tr></table></figure>
<p>這邊我只是加了，型態宣告而已喔～～ 呼叫 factorial(33) 以我個人電腦大概接近兩秒，然後呼叫 cfactorial（33) 大概0.5秒，讓我嚇到了呢，原來型態沒有確定的狀況會造成效率這麼大的差異呢～ </p>
<p>個人是覺得可以先試著用ipython來嘗試cython，玩一段時間後再來決定是否拿來應用在工作上。</p>
<h6 id="python"><a href="#python" class="headerlink" title="python"></a><code>python</code></h6>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2017/01/12/django-development-note-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/12/django-development-note-2/" itemprop="url">
                  Django development note 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-12T02:26:00+00:00">
                2017-01-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/django/" itemprop="url" rel="index">
                    <span itemprop="name">django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/12/django-development-note-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/01/12/django-development-note-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Django-development-note-2"><a href="#Django-development-note-2" class="headerlink" title="Django development note 2"></a>Django development note 2</h1><p>繼上次<a href="http://sillygod-blog.logdown.com/posts/249502-django-development-note-1" target="_blank" rel="external">django development note1</a>後，已經過了一段時間，咦～其實好像是挺長的時間，哈哈，總之呢，這段時期，前端技術方面，實在是苟日新，日日新，又日新， 近來sharp edge技術都是由前端那render頁面（就是指用js去渲染html），有不少的事情，已經慢慢從後端被拿到前端去負責了。</p>
<p>其中像是</p>
<ul>
<li>html render</li>
<li>url router</li>
<li>i18n</li>
<li>..等等</li>
</ul>
<p>但是django 本身有個template system， 就是由後端來render出頁面，我在公司嘗試過，將angularjs和django結合寫過公司官網，另外也試過reactjs和django結合，寫出電商網站，但是這邊的url router和部份html render其實都還是用django的system，其實並沒有做一個完全的前後端分割，沒有這麼做的原因是考量到seo的問題，傳統由server端渲染頁面的話，seo就不用擔心，因為爬蟲都爬的到，但是改成由js渲染的話，問題就大了，因為爬蟲不會解析js並且去運行，已目前的爬蟲來講的話啦，雖然有聽說，google爬蟲未來會有支援，但是未來是未來，我們要著眼當下是吧～ </p>
<p>因此url router是由django負責的話，我可以考慮哪些頁面是需要seo，先由後端給出這樣～ seo這個問題這麼大，像React他們是怎麼解決的呢？ 他們有所謂的render server，原理大致上，就是server先講js的邏輯run過，產生頁面，再回傳給client端，說是這樣說啦，但是你用了React+webpack後，尤其是css的buidle問題，就會跑出一堆啦，因為許許多多webpack套件當初只是為了frontend而寫，沒考慮到拿到backend是否能run，所以其實render server沒那麼簡單。</p>
<p>個人研究後，看到universal概念，就是為了上述問題… 而產生的， 其實有個範例叫universal react redux 啥的，就有用render server，老實講實在挺恐怖的，只要一扯到universal，不知道為啥裡面整個用到超多套件，邏輯複雜.. 設定也麻煩， 明明React超級夯，但是都人沒提出一個漂亮解決seo問題的方法，後來我和同事有稍微搞個universal react redux with django的測試專案，要的話可以到<a href="https://github.com/sillygod/django-react-test" target="_blank" rel="external">這邊參考</a>，老實講現在要我回去我應該很多都忘了xd 太多小套件了，在實作這專案期間其實有個叫做<a href="https://github.com/zeit/next.js/" target="_blank" rel="external">next.js</a>的東西，號稱zero setting的render server，實際上個人使用也的確是這樣，但是她有個很大限制，就是你不能自己寫webpack config！！ css也是只能寫在js檔裡，這也難怪它是zero setting囉～  但是我想等以後這個套件就會越來越方便啦，值得期待。</p>
<p>經過在公司一年多以來的經驗，我後來自己整理了一些後端project starter架構，個人而言我覺得後端可以開始只要做為純api server，也就是說url router，template system，有的沒的都可以去掉了，專心設計api，剩下的都搬到前端去，這麼做的好處在哪？ 至少是有下面幾點</p>
<ul>
<li>前後端程式碼邏輯分割清楚</li>
</ul>
<p>有些人會想前端跟後端程式碼哪裡可以扯在一起？ 基本上只要你用的backend framework有template system，一定會有不少邏輯混在後端，然後前端在一起搭配，之前進入公司發現一堆magic code和bug都超難找，就是因為太多邏輯四散各地 :(  </p>
<p>後端變為純api後，前端頁面有所問題，毛頭出在哪，就往前端找阿xd，不用在霧裡探花，驀然回首原來bug就在經過處，每次都要仔細找後端哪裡暗插了什麼鬼怪code，遇過暗插inline css的，整個囧..  我想光是這個優點，就讓許多人開心了吧。</p>
<ul>
<li>前端不用懂django</li>
</ul>
<p>跟前面很像，因為分割清楚，加在環境也是分割，因此前端不需要知道django是怎麼運行，自己就可以搞環境，若是以前用法，前端需要懂一點django，才知道怎麼run測試server，甚至還要migration你說是不是～ 身為一個前端還要懂後端，豈不是很麻煩？ 無法專心在前端上</p>
<ul>
<li>前端開始具有架構性</li>
</ul>
<p>由於webpack或是gulp之類的工具存在，開始讓前端具有一定的結構性，其實這是好事～<br>但是這麼分割後，前端的架構究竟該怎麼弄會比較好？ 這邊我還不知道xd 畢竟我本分是後端嘛～ 雖然我略懂一些js和css， 最近我會研究一下前端架構，有一定心得後，我改日必定放上 :)</p>
<p>說了這麼多，好像都還沒提到django development相關心得，哈哈，前面都只是一些經歷讓我整理了後來的<a href="https://github.com/sillygod/django-as-pure-api-server" target="_blank" rel="external">django as pure api server</a>架構，下面來進行大綱性的解說</p>
<h4 id="專案架構"><a href="#專案架構" class="headerlink" title="專案架構"></a>專案架構</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">api/</div><div class="line">  ....</div><div class="line">  ..</div><div class="line">core/</div><div class="line">  settings/</div><div class="line">  wsgi/</div><div class="line">  __init__.py</div><div class="line">  urls.py</div><div class="line">  wsgi.py</div><div class="line">nginx/</div><div class="line">  nginx.conf</div><div class="line">requirements/</div><div class="line">  dev.txt</div><div class="line">  prod.txt</div><div class="line">Dockerfile</div><div class="line">docker-compose.yml</div><div class="line">manage.py</div><div class="line">circle.yml</div><div class="line">pytest.ini</div></pre></td></tr></table></figure>
<p>這是一個簡略的專案架構簡介，想要更詳細的了解，可以去<a href="https://github.com/sillygod/django-as-pure-api-server" target="_blank" rel="external">django as pure api server</a>了解，從這邊可以知道我至少用了docker和docker-compose還有circle ci的東西，這部份跟持續整合比較有關係，其實目前來講關於docker這邊，用到的地方除了未來<strong>持續整合</strong>那邊可以用到外，就是我本地可以先進行模擬正式台環境，確保不會有意外出現，我自己在開發中其實還是用django的runserver啦，其實真的是最方便，當然有興趣的人可以使用docker-compose一下，但是對於debug時，我暫時還沒想要怎麼弄xd  因為平常debug django app時，我都是用<code>python -m pdb manage.py runserver</code>，那麼使用docker-compose時我還沒研究要怎麼attach process裡～～ </p>
<p><strong>個人覺得<a href="https://www.docker.com/" target="_blank" rel="external">docker</a>是一個值得投入心力去學習的工具</strong></p>
<p>比如像我個人是使用<a href="https://elementary.io/en/" target="_blank" rel="external">elementary os</a>作業系統，個人寫了一個<a href="https://gist.github.com/sillygod/6d37ef7e4a02d253e743#file-eos_loki-sh" target="_blank" rel="external">安裝腳本</a>，之前我要測試這腳本是否能夠正常運行，我都會用vmware player，灌elementary os，來進行，但是頗麻煩，而且感覺有浪費空間，有了docker後，由於elementary os loki，是基於ubuntu16.04，所以這邊我只要使用ubuntu16.04 image，來進行測試，run個container，就可以跑一下我的腳本看看過程是否有錯誤這樣，測完就可以砍掉啦～清爽～</p>
<p>再來對於nginx和uwsgi設置，這邊我也可以用docker來進行模擬，而不用真的灌在自己主機上，要不然自己主機越灌越多東西，會變慢的，只能說docker真的是一個很棒的工具，也難怪她後來夯成這樣。</p>
<p>docker-compose就是一個輔助你使用docker的工具，原理就是寫一個設定檔(yml)，她會自動幫你建立環境，省去你打超多docker指令和開啟一堆terminal哈哈。</p>
<p><strong>pytest</strong></p>
<p>pytest的話，就是拿來執行測試用的套件，老實講要怎麼寫出好的測試，我目前無法給出一個心得，因為這實在是太難囉～ 這邊需要讓我花時間研究一下</p>
<p>再來使用的套件方面，以下列出個人覺得值得一提的</p>
<ul>
<li><a href="https://github.com/jazzband/django-debug-toolbar" target="_blank" rel="external">django debug toolbar</a></li>
</ul>
<p>是一個挺不錯的工具，對於sql的效率分析很有幫助，除了sql以外，她其實有許多分析和記錄，但是我不常用。 然後<strong>請注意</strong>，在production請拿掉這個套件，這個會吃掉你不少效能，這跟python built-in module profile是一樣意思，這種分析的套件都是插入執行分析，必定會影響你程式運行效能</p>
<ul>
<li><a href="https://github.com/deschler/django-modeltranslation" target="_blank" rel="external">django modeltranslation</a></li>
</ul>
<p>對於model資料有i18n，覺得這套件不錯，因為有個很大的重點他不會破壞你原本的model，之前是使用<a href="https://github.com/django-parler/django-parler" target="_blank" rel="external">django-parler</a>，雖然當初用的時候覺得不錯，但是這個是使用繼承的方式，所以會破壞到model的一些特性，而且她有個很大的麻煩處，就是無法使用model inheritance，幸好當初我用的case只是文章性質的需求，所以不用用到複雜的功能</p>
<ul>
<li><a href="http://www.django-rest-framework.org/" target="_blank" rel="external">django rest framework</a></li>
</ul>
<p>這個應該不用多解釋了吧，用django的各位，想要實作rest api，多半應該都是用這套了吧，我之前文章有一些心得，可以去翻翻～</p>
<ul>
<li><a href="https://github.com/marcgibbons/django-rest-swagger" target="_blank" rel="external">django rest swagger</a></li>
</ul>
<p>就是一個可以當作api doc和測試的頁面，說實在的目前用起來就是一種缺少文檔的感覺，所以有些地方實在還不知道怎麼去調整，但是整體上而言算是不錯用，讓你的文檔，變成互動式的，而不是以前那樣呆板的文件</p>
<h3 id="最後"><a href="#最後" class="headerlink" title="最後"></a>最後</h3><p>對於django要不要升級到1.1x版，其實我還在考量，但是未來勢必是要升級的啦，因為他是沒有向後兼容的升級，這感覺就是當初python2跟3的抉擇，目前而言我選擇在django&lt;1.9 ， 是一個穩定修復bug的版本，但是我目前用到的專案是有故意選的，大致都有支援到django 1.1x後，所以要升級其實應該是不難，只是尚在考量中（其實是懶 :p</p>
<h6 id="tags-django-python"><a href="#tags-django-python" class="headerlink" title="tags: django python"></a>tags: <code>django</code> <code>python</code></h6>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2016/12/16/1212573/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/16/1212573/" itemprop="url">
                  Spacemacs 使用心得
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-16T06:31:00+00:00">
                2016-12-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/editor/" itemprop="url" rel="index">
                    <span itemprop="name">editor</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/editor/spacemacs/" itemprop="url" rel="index">
                    <span itemprop="name">spacemacs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/16/1212573/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/12/16/1212573/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spacemacs-使用心得"><a href="#Spacemacs-使用心得" class="headerlink" title="Spacemacs 使用心得"></a>Spacemacs 使用心得</h1><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>身為一個programmer，一定會用過許多不同的editor or IDE，目前用過感覺不錯的就大概是下面這幾個，</p>
<ul>
<li><a href="https://atom.io/" target="_blank" rel="external">atom</a></li>
<li><a href="https://code.visualstudio.com/c?utm_expid=101350005-35.Eg8306GUR6SersZwpBjURQ.2&amp;utm_referrer=https%3A%2F%2Fwww.google.com.tw%2F" target="_blank" rel="external">visual studio code</a></li>
<li><a href="https://www.sublimetext.com/3" target="_blank" rel="external">sublime text</a></li>
<li><a href="http://spacemacs.org/" target="_blank" rel="external">spacemacs</a></li>
</ul>
<p>以上順序並沒有按照好用程度安排，上面是列出比較general use的，像對於python而言，當今算是頗強的IDE，應該就屬pycharm了吧，不過這就不列入心得，這邊是註記general use而且偏向editor。</p>
<p>上面這些其實我都有用過才列出來的，最剛開始我是用sublime text，在他剛出來的時期，真的是輕巧，好用，就算是現在應該也不少人在用啦，對於我本身是用python開發的，也有套件支援一些比較基本的 code completion， find usages 等等功能， 只是之後就出現基於<a href="http://electron.atom.io/" target="_blank" rel="external">electron</a>開發的editor， vs code和atom這兩者都是，這兩個都不錯用，我後來也從sublime text轉到atom，原因其實很簡單 :) 因為atom的theme十分漂亮，畢竟electron嘛～ 可以輕易用css刻介面，而且老實說插件品質也不錯，另外sublime text感覺已經幾乎沒啥重大更新了，另外關於vs code我只能說如果你的專案是前端相關的，後端又是用nodejs，那我想這個絕對非常符合你的需求，另外專案如果很肥，用vs code會比較順，許多朋友用過也是說vs code效能比較高，甚至有朋友說他電腦用atom，有時候會當＠＠  我個人是沒遇過啦～ 這邊就不引戰 :p</p>
<p>或許你們會說用一個編輯器熟悉熟悉就好，幹嘛學那麼多套，其實我也這樣想過～  其實我當初以為atom我會用挺長的時間，只是莫名的我發現<strong>spacemacs</strong>，試玩過後，我發現似乎回不去了xd 可以先跟你說說atom可是有插件特意學他的快捷方式呢～  首先就先來大致上的介紹一下<strong>spacemacs</strong></p>
<h3 id="正題-spacemacs"><a href="#正題-spacemacs" class="headerlink" title="正題 spacemacs"></a>正題 spacemacs</h3><p>一進去官網你會看到大標寫說，他是community-driven，好啦，現在應該大都是這樣了，重點是接下來你會看到的三個單字</p>
<ul>
<li>ergonomics</li>
<li>mnemonics</li>
<li>consistency</li>
</ul>
<p>第一個人體工學？ 很好，我當初看到也覺得只不過是一個編輯器，是在人體工學啥？ 這邊個人認為是快捷鍵的問題，emacs一直以來被人詬病的就是快捷鍵充滿的Ctrl or Alt的prefix，就是說你得先按ctrl or Alt的輔助鍵再按其他鍵，實在很難按～ 按久了手指可能會有問題吧，雖然一堆emacs神手說，好按、有邏輯，但是我用了不到一個禮拜就先放著了xd 阿！ 這邊忘了說，其實emacs我很早有碰過，但是沒特別繼續深入就先放著了，實在上手度太高，那時候反而是學vim先，學了一些基本的text object move, edit的東西，這邊也造成我後來要用的editor都一定要有vim mode，實在不得不說就是好用！ 編輯快速！</p>
<p>第二個記憶法，這邊指他的快捷設定是有邏輯的設定， 舉例： 他的快捷開頭是要先按 SPC （空白鍵）</p>
<ul>
<li>要看buffer list，就按 SPC b b</li>
<li>要看project的buffer list，就按 SPC p b</li>
<li>要看project list， 就按 SPC p l</li>
</ul>
<p>看到這邊大家迫不及待想試試到底有多麼厲害吧～  接著就來安裝</p>
<p>安裝方法其實不難，首先先裝好emacs，然後github有教怎麼安裝spacemacs，其實～ spacemacs說穿就是一個幫你整合各方好用插件，然後自己本上有個類似插件loading system去管理的 emacs 設定檔， 所以安裝就是把github整包丟入 ~/.emacs.d，簡單明瞭，接著就是開始emacs，就會自動下載安裝啦，過程中會問你的什麼習慣忘了xd 反正就是選擇， 印象中是會有問你想要使用 evil 嗎？ 這邊我當然選是啦～ evil 就是 vim-mode， 老實講 evil 是我用過，模擬vim快捷，模擬最齊全的套件了，真的很強，他連vim的ex mode都有， 舉例來說就是 1,3d 把一到三行的內容刪掉這樣，evil 可是可以做呢～ </p>
<p>安裝完畢後，當你按下神聖的<strong>SPC</strong> ，你就會看到下面有彈出提示如圖<img src="http://i.imgur.com/DSnzrD0.png" alt="preview img"> ， 這是其中之一的原因讓我回不去，我只能說這太屌了，我不用硬是把各種快捷功能記下來，我只要用mnemonics way，去記憶相關大概鍵就好，剩下都會有提示，實在很棒，然後其實emacs功能實在是太多， 其實不是每個功能都會配置在 SPC x x 上面，這時候你就可以用 M-x (M是指meta key通常是指Alt鍵啦)，不知道mac上是怎樣喔～ 我沒用過mac， 按下 M-x，可以進行功能搜索，打出你要的功能名字就可以使用～ 這也是我很喜歡的功能！</p>
<p>再來就是emacs的window manager和buffer的概念，讓你檔案之間跳轉阿，編輯，或是查看code，文檔之類的十分好用， 幾乎是只要開啟emacs後，就可以做幾乎任何事了，甚至emacs內建 terminal emulator，算是不錯用，雖然個人目前還是幾乎在作業系統上的terminal做事比較習慣。</p>
<p><img src="http://i.imgur.com/ZI9N7hx.png" alt="preview image"><br>上圖示範就是window隨意切割，另外鼠標跳轉也很方便，<code>SPC w [H J K L]</code>， 左 下 上 右， 視窗間跳轉，spacemacs本身功能就算是非常齊全了，想當然爾身為一個好～～～用的editor，一定都有所謂的plugin系統，這邊只要<code>SPC f e d</code>， 就會跳去設定介面，在spacemacs裡是叫做layer</p>
<p><img src="http://i.imgur.com/MdLBpsv.png" alt="preview image"></p>
<p>上圖就是內容，如果你想要讓你的editor，對python擁有像ide般一些功能，就把python加入後並儲存，之後要進行refresh， <code>SPC f e R</code>，等待下載安裝完成就可以開始享用啦 :)</p>
<h3 id="第一次用emacs很多疑問？"><a href="#第一次用emacs很多疑問？" class="headerlink" title="第一次用emacs很多疑問？"></a>第一次用emacs很多疑問？</h3><p>我只能說是的，基本上網路上教學不少，但是沒很深入！ 可以先簡單看過後，邊用邊學，然後其實emacs本身就充滿文檔說明，所以他也常常被說 self-documented， 你可以按 C-h，就會看到下面跳出，提示，按下相對應鍵，就會看到針對什麼功能做說明， 我常用的是 C-h b ，可以幫你找到對應功能的key binding， 另外有一點很重要，有些模式下按？ 可以得到提示按鍵說明，像是你在neotree視窗裡面按下？ 就會有說明，比如按 c 就可以創造檔案之類的，是個好用的訣竅。</p>
<p>再來就是可以針對emacs的某功能進行網路搜尋解說了，因為emacs其實本身就是用elisp寫的，其實本身就是個超級插件大集合啦xd ， 所以一定會有相關說明，當然如果你本身懂lisp，我想你大可直接進入源碼，或許會看懂不少東西？ 我是沒看過啦 哇哈哈～</p>
<h3 id="目前工作上使用方式"><a href="#目前工作上使用方式" class="headerlink" title="目前工作上使用方式"></a>目前工作上使用方式</h3><p>因為我是用python開發，version control是用git，所以其實跟spacemacs剛好也很搭拉xd  尤其是spacemacs用magit，這個實在是超級好用！！！ 為此特別稍微介紹一下magit，我只能說真的讓我不用在terminal打那麼多東西啦 :) 不過用慣IDE的人就看過去就好xd</p>
<h4 id="magit"><a href="#magit" class="headerlink" title="magit"></a>magit</h4><p>實在不得不說，這個真的是一個另我對gui介面類型？git的軟體有所改觀的東西，以前用過source tree類型的軟體，算是好用啦，但是說實在的，專案一大每次loading都要一段時間，而且操作彈性實在不大～ 或者其實是做的到的，只是不好找怎麼點，說到這裡你一定還是很好奇，<strong>magit</strong>厲害在哪？ 其實應該這麼說，搭配spacemacs+evil，實在好用，舉例</p>
<p>首先<code>SPC g s</code>，這樣就會進入mgit模式，接下來呢？ 不知道可以按什麼鍵對吧？ 記得前面講過的在很多模式下你可以按<code>？</code>，就會跳出提示，如下圖的右下角</p>
<p><img src="http://i.imgur.com/t8HPUm9.png" alt="image"></p>
<p>有看到s快捷指的是stage吧，再來對於這功能來測試看看</p>
<h6 id="選擇我想stage的檔案"><a href="#選擇我想stage的檔案" class="headerlink" title="選擇我想stage的檔案"></a>選擇我想stage的檔案</h6><p>只要進入visual mode，選到你想選的檔案，再按s鍵（快捷鍵），就相當於 git add [files you choose]</p>
<p>藉由類似這種搭配，像是commit，diff之類的，其實視窗跳轉都在emacs內，非常方便，而且一堆git指令都有綁定按鍵，像是pull from origin，按個 p u 之類的， 讓我雙手保持不離開鍵盤，同時又可以讓我非常快速的進行version control，以前我都是用terminal直接打指令，老實講打到手好酸阿xd 哈哈，magit就像magic一般，我沒想過可以享受輕鬆的按幾個鍵，就可以做完這些version control。</p>
<p>可惜的是目前只有git有這麼棒的套件，mercurial個人是還沒看到～</p>
<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><p>spacemacs本身就有個python layer，做了挺完全的功能支援，尤其是虛擬環境挺容易啟動的(<code>, V a</code>)，追尋源碼（使用evil的話，快捷是g d十分方便），還有對於ipython repl的一些send code buffer的功能，這個好用，對於想要即時試用部份代碼的功能是否正常運行很方便，個人常用<code>, s R</code> 這會將我目前選取的code傳進ipython的repl。</p>
<p>debug的話，目前個人還是在terminal裡使用pdb， emacs本身是有作結合啦，就是<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Debuggers.html" target="_blank" rel="external">GUD</a>，讓你像一般ide debug那樣的fu，但是我沒有特別使用，所以這邊就不多敘述了。</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>我這邊講到的還只是spacemacs冰山一角，他的layer（plugins）實作非常豐富，對於我工作上，開發效率是有所提昇的。唯一比較讓我比較卡的地方可能就是，因為emacs都是用elisp寫的，所以你要改插件或自寫插件會比較麻煩～  除非你本身就滿懂lisp的， 總之呢，spacemacs還有很多東西可以去碰，去學，像是macro， undo-rings 有的沒的，現在我也才用spacemacs大概兩個月，而且也沒特別深入學習，因此暫時只能記錄這些心得。</p>
<h6 id="tags-editor"><a href="#tags-editor" class="headerlink" title="tags: editor"></a>tags: <code>editor</code></h6>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2016/08/29/the-first-react-native/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/29/the-first-react-native/" itemprop="url">
                  初嘗react native
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-08-29T14:39:00+00:00">
                2016-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react-native/" itemprop="url" rel="index">
                    <span itemprop="name">react native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/29/the-first-react-native/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/29/the-first-react-native/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="初嘗-React-Native"><a href="#初嘗-React-Native" class="headerlink" title="初嘗 React Native"></a>初嘗 React Native</h1><h3 id="學習動機"><a href="#學習動機" class="headerlink" title="學習動機"></a>學習動機</h3><p>有鑑於最近公司比較沒事，所以就心血來潮來玩一下，其實這還算是玩具性質的專案，有著效率上的問題，而且應該會有不少地雷存在，雖然他說得很漂亮，什麼write once, run anywhere? 當然我覺得這不是不可能，只是大概需要很常的時間，才能做到，不過呢，反正時間多出來了，就來玩玩看也不吃虧。</p>
<h3 id="環境設置"><a href="#環境設置" class="headerlink" title="環境設置"></a>環境設置</h3><p>這邊是以Linux(ubuntu 14.04)為例，<a href="https://facebook.github.io/react-native/releases/next/docs/getting-started.html" target="_blank" rel="external">官網</a>其實都有教學，只是在ubuntu上面通常安裝相對於,mac和windows來講都會比較麻煩點.. 我也不知道為什麼，linux的東西，一直以來懶人包好像都比較少，不像其他平台都是點一點就安裝好啦～～ </p>
<p>安裝node環境那邊很簡單就不多說， react native command line 安裝方法也滿簡單的如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g react-native-cli</div></pre></td></tr></table></figure>
<p>主要是 Android Studio這邊，首先呢！ 你必須先安裝一下java環境，最好是oracle的java， ubuntu還有個open java，我想畢竟android是用oracle java開發的，所以最好還是用oracle吧，當然有人想試試open jdk的，試玩再告訴我心得 :)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo add-apt-repository ppa:webupd8team/java</div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install oracle-java8-installer</div><div class="line">sudo apt-get install oracle-java8-set-default</div></pre></td></tr></table></figure>
<p>至於安裝jre環境這邊我是用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install default-jre</div></pre></td></tr></table></figure>
<p>java環境這邊告一段落， 再來去<a href="https://developer.android.com/studio/index.html" target="_blank" rel="external">android studio</a>官網下載安裝檔，接著根據官方說明文件～ 請先做一個步驟</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install lib32z1 lib32ncurses5 lib32bz2-1.0 lib32stdc++6</div></pre></td></tr></table></figure>
<p>這個是你系統是64bit ubuntu的話，再安裝這些，看起來他是需要32bit的library，所以才安裝這些，接著剛剛下載完的檔案，沒意外應該要是一個zip檔，就把他解壓到你要的地方吧，一般而言會是放在 /opt/下面，你爽就好 :p</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo unzip android-studio.zip -d /opt</div></pre></td></tr></table></figure>
<p>這樣就算是安裝完成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/android-studio/bin/studio.sh</div></pre></td></tr></table></figure>
<p>上面就是啟動方式， 不過啟動程式這樣很麻煩對吧， 你想要的話，其實可以把 /opt/android-studio/bin/ 加入系統路徑， 這樣就可以簡短指令， 你只要 sutdio.sh 這樣就可以啟動了。</p>
<p>不過我個人會比較想要建立一個 Desktop file 來啟動，就是像是桌面捷徑的感覺，點兩下就啟動程式，以下是Desktop file的內容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[Desktop Entry]</div><div class="line">Version=1.0</div><div class="line">Type=Application</div><div class="line">Name=Android Studio</div><div class="line">Exec=&quot;/opt/android-studio/bin/studio.sh&quot; %f</div><div class="line">Icon=/opt/android-studio/bin/studio.png</div><div class="line">Categories=Development;IDE;</div><div class="line">Terminal=false</div><div class="line">StartupNotify=true</div><div class="line">StartupWMClass=android-studio</div></pre></td></tr></table></figure>
<p>把檔案存在 ~/.local/share/applications/ 下面，這樣就可以建立捷徑了～</p>
<p><strong>Watchman</strong>這個他是沒說一定要裝啦，只是看起來裝了這個，開發上效率似乎會比較好，所以就都安裝啦， 哈哈哈哈阿， 這裡我選擇直接<a href="https://facebook.github.io/watchman/docs/install.html#installing-from-source" target="_blank" rel="external">install from source</a> 的方式，最簡單明瞭 :)</p>
<p>再來差不多可以往下進行啦～</p>
<h3 id="Reactive-Hello-World"><a href="#Reactive-Hello-World" class="headerlink" title="Reactive Hello World"></a>Reactive Hello World</h3><p>雖然官網就給個幾行指令，說這樣就可以啟動example了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">react-native init AwesomeProject </div><div class="line">cd AwesomeProject </div><div class="line">react-native run-android</div></pre></td></tr></table></figure>
<p>但是～～～ 事實果然就是沒那麼簡單喔～ 人生總是期待越高，失望越大。 疑！ 突然好像有點悲觀（題外話</p>
<p>這邊要注意的是，請記得先啟動你的Android Studio，他會安裝android-sdk相關的東西，這邊需要注意版本， example 使用的是 23 版， 但是啟動時，我的是先安裝 24版的，所以記得安裝一下，安裝完後， 記得設置 <code>ANDROID_HOME</code>這個環境變數，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export ANDROID_HOME=$HOME/Android/Sdk</div><div class="line">export PATH=&quot;$HOME/Android/Sdk/platform-tools:$HOME/Android/Sdk/tools:$PATH&quot;</div></pre></td></tr></table></figure>
<p>我的配置如上， 這樣一來大致上就沒問題了~~ 大概…吧</p>
<p>可是！ 我錯了， 哈 第一次用關於android的東西，看了錯誤訊息，似乎是他需要先運行一個模擬器呢～ 所以我選擇是<code>Genymotion</code>公司的android員工說是用這個，說效率比較好，所以就先採取他們的意見啦 :)</p>
<p>哈～ 不過呢！ 後來先換成用google的模擬器吧， Genymotion在ubuntu 15 以下版本，安裝有點步驟，頗麻煩… 首先先看看你的模擬器有哪些裝置，當然這邊你也可以自己建立一個模擬器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">android list targets</div><div class="line">android create avd -n react -t 1 --abi default/x86_64</div><div class="line">emulator -avd react  # 啟動模擬器</div></pre></td></tr></table></figure>
<p>值得注意的是有許多地方都需要依靠 android sdk manager，來安裝一些tool～</p>
<p>啟動完模擬器後，雖然官網說執行 <code>react-native run-android</code> 這行就可以了，但是沒意外你應該會出現<strong>紅色錯誤</strong>，官方自己下面也補充了，請額外執行 <code>react-native start</code> 這行，這樣一來就可以看到成功畫面了，如下</p>
<p><img src="http://i.imgur.com/oaTJs2U.png" alt="screenshot"></p>
<p>但是有個問題，你會發現這個模擬器並沒有和我們的鍵盤連線，也就是你按了鍵盤毫無反應，也就無法享受到他給你的double tap R，更新的效果，所以接著我們要解決這個問題， 嘖嘖在linux上問題總是許多，我是不知道其他平台也是不是會遇到這些問題啦～～</p>
<p>重點在，要先啟動 avd manager， 這邊我找超久… 原來不是在android studio裡面，直接在command line裡面輸入<code>android avd</code>就可以打開了..我都快要翻桌了！！ 接著設置允許keyboard，之後就可以享用按兩下R就更新的快感啦！ 哈哈哈哈哈哈</p>
<p>好啦，起手式就到這邊為止，再來我要先來繼續看基本教學，有了一定心得後，再來po一篇文章。</p>
<h6 id="tags-react-native"><a href="#tags-react-native" class="headerlink" title="tags: react-native"></a>tags: <code>react-native</code></h6>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2016/08/18/understanding-rest-framework-serializer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/18/understanding-rest-framework-serializer/" itemprop="url">
                  rest framework serializer 深入理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-08-18T01:44:00+00:00">
                2016-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/rest-framework/" itemprop="url" rel="index">
                    <span itemprop="name">rest framework</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/18/understanding-rest-framework-serializer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/18/understanding-rest-framework-serializer/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="rest-framework-serializer-深入理解"><a href="#rest-framework-serializer-深入理解" class="headerlink" title="rest framework serializer 深入理解"></a>rest framework serializer 深入理解</h1><p>這篇主要是記錄一些個人對於rest framework的serializer源碼實作的理解，從下段源碼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@six.add_metaclass(SerializerMetaclass)</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Serializer</span><span class="params">(BaseSerializer)</span>:</span></div><div class="line">	....</div></pre></td></tr></table></figure>
<p>可以看到作為ModelSerializer還有一些xxSerializer的<strong>base class(Serializer)</strong>，是繼承BaseSerializer，以及還有個metaclass，首先我們就先來看看meta class這邊，它用到了six這個third party library，這模組主要目的是幫你弄出python2和3 compatible的code，<code>@six.add_metaclass</code>這個東西作用如下，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@six.add_metaclass(SerializerMetaclass)</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Serializer</span><span class="params">(BaseSerializer)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div><div class="line">	</div><div class="line"><span class="comment"># to python2</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Serializer</span><span class="params">(BaseSerializer)</span>:</span></div><div class="line">	__metaclass__ = SerializerMetaclass</div><div class="line">	</div><div class="line">	<span class="keyword">pass</span></div><div class="line">	</div><div class="line"><span class="comment"># to python3</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Serializer</span><span class="params">(BaseSerializer, metaclass=SerializerMetaclass)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>至於對於metaclass的作用，這邊我不多加敘述，詳情可以看我之前的blog，有篇是對於metaclass的理解，SerializerMetaclass做的事情，基本上是在我們new instance時，把attribute屬於Field的instance給濾出來～ 這個Field是rest framework fields.py裡面有所定義，濾出來後呢，接著按照_creation_counter來排序，之後把這些給assgin到<code>_declared_fields</code>看到這邊目前不知道為什麼要作這個動作，不過我相信我們繼續看下去應該就會知道為什麼了？ 這個metaclass做的事情就是這樣而已。</p>
<p>接著由於BaseSerializer是繼承Field，所以我們先來看看Field是作什麼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Field</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    _creation_counter = <span class="number">0</span></div><div class="line">    <span class="comment"># 用來做欄位排序～ 疑你想說哪邊有做排序</span></div><div class="line">    <span class="comment"># 目前而言我們看到在metaclass那邊他有利用這個屬性來做排序（我沒有貼源碼上來）</span></div><div class="line"></div><div class="line">    default_error_messages = &#123;</div><div class="line">        <span class="string">'required'</span>: _(<span class="string">'This field is required.'</span>),</div><div class="line">        <span class="string">'null'</span>: _(<span class="string">'This field may not be null.'</span>)</div><div class="line">    &#125;</div><div class="line">    default_validators = []</div><div class="line">    default_empty_html = empty</div><div class="line">    initial = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, read_only=False, write_only=False,</span></span></div><div class="line">                 required=None, default=empty, initial=empty, source=None,</div><div class="line">                 label=None, help_text=None, style=None,</div><div class="line">                 error_messages=None, validators=None, allow_null=False):</div><div class="line">        self._creation_counter = Field._creation_counter</div><div class="line">        Field._creation_counter += <span class="number">1</span></div><div class="line"></div><div class="line">        <span class="comment"># If `required` is unset, then use `True` unless a default is provided.</span></div><div class="line">        <span class="keyword">if</span> required <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            required = default <span class="keyword">is</span> empty <span class="keyword">and</span> <span class="keyword">not</span> read_only</div><div class="line">            <span class="comment"># 這邊而言我的確不懂為什麼default要用emtpy，但是這邊註解寫的清楚，沒有給required時預設就是True</span></div><div class="line"></div><div class="line">        <span class="comment"># Some combinations of keyword arguments do not make sense.</span></div><div class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> (read_only <span class="keyword">and</span> write_only), NOT_READ_ONLY_WRITE_ONLY</div><div class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> (read_only <span class="keyword">and</span> required), NOT_READ_ONLY_REQUIRED</div><div class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> (required <span class="keyword">and</span> default <span class="keyword">is</span> <span class="keyword">not</span> empty), NOT_REQUIRED_DEFAULT</div><div class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> (read_only <span class="keyword">and</span> self.__class__ == Field), USE_READONLYFIELD</div><div class="line">        <span class="comment"># 這邊做的事就只是檢查一些不合理的flag設置比如第一個你同時設置read_only和write_only為True</span></div><div class="line">        <span class="comment"># 有夠不合理吧 :)</span></div><div class="line"></div><div class="line">        self.read_only = read_only</div><div class="line">        self.write_only = write_only</div><div class="line">        self.required = required</div><div class="line">        self.default = default</div><div class="line">        self.source = source</div><div class="line">        self.initial = self.initial <span class="keyword">if</span> (initial <span class="keyword">is</span> empty) <span class="keyword">else</span> initial</div><div class="line">        self.label = label</div><div class="line">        self.help_text = help_text</div><div class="line">        self.style = &#123;&#125; <span class="keyword">if</span> style <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">else</span> style</div><div class="line">        self.allow_null = allow_null</div><div class="line"></div><div class="line">        <span class="keyword">if</span> self.default_empty_html <span class="keyword">is</span> <span class="keyword">not</span> empty:</div><div class="line">            <span class="keyword">if</span> default <span class="keyword">is</span> <span class="keyword">not</span> empty:</div><div class="line">                self.default_empty_html = default</div><div class="line"></div><div class="line">        <span class="keyword">if</span> validators <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">            self.validators = validators[:]</div><div class="line"></div><div class="line">        <span class="comment"># These are set up by `.bind()` when the field is added to a serializer.</span></div><div class="line">        self.field_name = <span class="keyword">None</span></div><div class="line">        self.parent = <span class="keyword">None</span></div><div class="line"></div><div class="line">        <span class="comment"># Collect default error message from self and parent classes</span></div><div class="line">        messages = &#123;&#125;</div><div class="line">        <span class="keyword">for</span> cls <span class="keyword">in</span> reversed(self.__class__.__mro__):</div><div class="line">            messages.update(getattr(cls, <span class="string">'default_error_messages'</span>, &#123;&#125;))</div><div class="line">        messages.update(error_messages <span class="keyword">or</span> &#123;&#125;)</div><div class="line">        self.error_messages = messages</div><div class="line">        <span class="comment"># 這邊可以注意 message: key-pair 被覆蓋的順序～</span></div></pre></td></tr></table></figure>
<p>關於init函式，一些需要注意的地方我都寫在註解上面了，當然有些參數目前還不知道是要做啥，但是不明的東西就先打個問號，因為你在怎麼執著於這邊，你也不知道答案是什麼，必須要看到其他地方式怎麼使用這些參數的或函式，才會比較明瞭，所以姑且就繼續往下看吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bind</span><span class="params">(self, field_name, parent)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Initializes the field name and parent for the field instance.</div><div class="line">        Called when a field is added to the parent serializer instance.</div><div class="line">        """</div><div class="line"></div><div class="line">        <span class="comment"># In order to enforce a consistent style, we error if a redundant</span></div><div class="line">        <span class="comment"># 'source' argument has been used. For example:</span></div><div class="line">        <span class="comment"># my_field = serializer.CharField(source='my_field')</span></div><div class="line">        <span class="keyword">assert</span> self.source != field_name, (</div><div class="line">            <span class="string">"It is redundant to specify `source='%s'` on field '%s' in "</span></div><div class="line">            <span class="string">"serializer '%s', because it is the same as the field name. "</span></div><div class="line">            <span class="string">"Remove the `source` keyword argument."</span> %</div><div class="line">            (field_name, self.__class__.__name__, parent.__class__.__name__)</div><div class="line">        )</div><div class="line"></div><div class="line">        self.field_name = field_name</div><div class="line">        self.parent = parent</div><div class="line"></div><div class="line">        <span class="comment"># `self.label` should default to being based on the field name.</span></div><div class="line">        <span class="keyword">if</span> self.label <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            self.label = field_name.replace(<span class="string">'_'</span>, <span class="string">' '</span>).capitalize()</div><div class="line"></div><div class="line">        <span class="comment"># self.source should default to being the same as the field name.</span></div><div class="line">        <span class="keyword">if</span> self.source <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            self.source = field_name</div><div class="line"></div><div class="line">        <span class="comment"># self.source_attrs is a list of attributes that need to be looked up</span></div><div class="line">        <span class="comment"># when serializing the instance, or populating the validated data.</span></div><div class="line">        <span class="keyword">if</span> self.source == <span class="string">'*'</span>:</div><div class="line">            <span class="comment"># magic star!!  雖然不知道是做啥～ 繼續看下去就會知道了</span></div><div class="line">            self.source_attrs = []</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.source_attrs = self.source.split(<span class="string">'.'</span>)</div></pre></td></tr></table></figure>
<p>單單這樣看好像挺模糊的，他的assert希望 self.source 和 field_name 一樣，可是好玩的是假如self.source是None的話，self.source = field_name，所以這邊我有點不懂她是在assert啥…</p>
<p>再來下面四個method，就比較簡單了，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validators</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_validators'</span>):</div><div class="line">            self._validators = self.get_validators()</div><div class="line">        <span class="keyword">return</span> self._validators</div><div class="line"></div><div class="line"><span class="meta">    @validators.setter</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validators</span><span class="params">(self, validators)</span>:</span></div><div class="line">        self._validators = validators</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_validators</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.default_validators[:]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_initial</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Return a value to use when the field is being returned as a primitive</div><div class="line">        value, without any object instance.</div><div class="line">        """</div><div class="line">        <span class="keyword">return</span> self.initial</div></pre></td></tr></table></figure>
<p>雖然我個人覺得啦，她分的好細，乍看之下或許有點多餘，不過看久了到是覺得還好，反正邏輯很簡單，只要沒有做過 self.validators = …. 那她就會使用 self.default_validators[:] 來回傳結果～</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_value</span><span class="params">(self, dictionary)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Given the *incoming* primitive data, return the value for this field</div><div class="line">        that should be validated and transformed to a native value.</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> html.is_html_input(dictionary):</div><div class="line">            <span class="comment"># HTML forms will represent empty fields as '', and cannot</span></div><div class="line">            <span class="comment"># represent None or False values directly.</span></div><div class="line">            <span class="keyword">if</span> self.field_name <span class="keyword">not</span> <span class="keyword">in</span> dictionary:</div><div class="line">                <span class="keyword">if</span> getattr(self.root, <span class="string">'partial'</span>, <span class="keyword">False</span>):</div><div class="line">                    <span class="keyword">return</span> empty</div><div class="line">                <span class="keyword">return</span> self.default_empty_html</div><div class="line">            ret = dictionary[self.field_name]</div><div class="line">            <span class="keyword">if</span> ret == <span class="string">''</span> <span class="keyword">and</span> self.allow_null:</div><div class="line">                <span class="comment"># If the field is blank, and null is a valid value then</span></div><div class="line">                <span class="comment"># determine if we should use null instead.</span></div><div class="line">                <span class="keyword">return</span> <span class="string">''</span> <span class="keyword">if</span> getattr(self, <span class="string">'allow_blank'</span>, <span class="keyword">False</span>) <span class="keyword">else</span> <span class="keyword">None</span></div><div class="line">            <span class="keyword">elif</span> ret == <span class="string">''</span> <span class="keyword">and</span> <span class="keyword">not</span> self.required:</div><div class="line">                <span class="comment"># If the field is blank, and emptyness is valid then</span></div><div class="line">                <span class="comment"># determine if we should use emptyness instead.</span></div><div class="line">                <span class="keyword">return</span> <span class="string">''</span> <span class="keyword">if</span> getattr(self, <span class="string">'allow_blank'</span>, <span class="keyword">False</span>) <span class="keyword">else</span> empty</div><div class="line">            <span class="keyword">return</span> ret</div><div class="line">        <span class="keyword">return</span> dictionary.get(self.field_name, empty)</div></pre></td></tr></table></figure>
<p>這裡html.is_html_input，是做一個檢查，是什麼呢？ 她檢查 dictionary是否擁有 getlist 這個屬性，很好，值得注意的是這裡的dictionary，似乎是因為有可能會是django的MultiValueDict，這個就會有getlist這個屬性了，相信之後部份code會用到這個method，讓我們就先繼續往下走～～</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_attribute</span><span class="params">(self, instance)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Given the *outgoing* object instance, return the primitive value</div><div class="line">        that should be used for this field.</div><div class="line">        """</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">return</span> get_attribute(instance, self.source_attrs)</div><div class="line">        <span class="keyword">except</span> (KeyError, AttributeError) <span class="keyword">as</span> exc:</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.required <span class="keyword">and</span> self.default <span class="keyword">is</span> empty:</div><div class="line">                <span class="keyword">raise</span> SkipField()</div><div class="line">            msg = (</div><div class="line">                <span class="string">'Got &#123;exc_type&#125; when attempting to get a value for field '</span></div><div class="line">                <span class="string">'`&#123;field&#125;` on serializer `&#123;serializer&#125;`.\nThe serializer '</span></div><div class="line">                <span class="string">'field might be named incorrectly and not match '</span></div><div class="line">                <span class="string">'any attribute or key on the `&#123;instance&#125;` instance.\n'</span></div><div class="line">                <span class="string">'Original exception text was: &#123;exc&#125;.'</span>.format(</div><div class="line">                    exc_type=type(exc).__name__,</div><div class="line">                    field=self.field_name,</div><div class="line">                    serializer=self.parent.__class__.__name__,</div><div class="line">                    instance=instance.__class__.__name__,</div><div class="line">                    exc=exc</div><div class="line">                )</div><div class="line">            )</div><div class="line">            <span class="keyword">raise</span> type(exc)(msg)</div></pre></td></tr></table></figure>
<p>這裡有call一個global get_attribue 這個之後看，當發生exception（KeyError, AttribueError）時，這裡做的處理是如果此field非required和default是empty的話，就會raise SkipField（），要不然就是照樣raise該有的錯誤，只是給她額外增加一個比較fancy的錯誤訊息。再來讓我們瞧瞧global的get_attribue到底做了什麼！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_attribute</span><span class="params">(instance, attrs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Similar to Python's built in `getattr(instance, attr)`,</div><div class="line">    but takes a list of nested attributes, instead of a single attribute.</div><div class="line"></div><div class="line">    Also accepts either attribute lookup on objects or dictionary lookups.</div><div class="line">    """</div><div class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> attrs:</div><div class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="comment"># Break out early if we get `None` at any point in a nested lookup.</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">if</span> isinstance(instance, collections.Mapping):</div><div class="line">                instance = instance[attr]</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                instance = getattr(instance, attr)</div><div class="line">        <span class="keyword">except</span> ObjectDoesNotExist:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">if</span> is_simple_callable(instance):</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                instance = instance()</div><div class="line">            <span class="keyword">except</span> (AttributeError, KeyError) <span class="keyword">as</span> exc:</div><div class="line">                <span class="comment"># If we raised an Attribute or KeyError here it'd get treated</span></div><div class="line">                <span class="comment"># as an omitted field in `Field.get_attribute()`. Instead we</span></div><div class="line">                <span class="comment"># raise a ValueError to ensure the exception is not masked.</span></div><div class="line">                <span class="keyword">raise</span> ValueError(<span class="string">'Exception raised in callable attribute "&#123;0&#125;"; original exception was: &#123;1&#125;'</span>.format(attr, exc))</div><div class="line"></div><div class="line">    <span class="keyword">return</span> instance</div></pre></td></tr></table></figure>
<p>還記得前面<code>bind</code> method做了什麼好事嗎？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> self.source == <span class="string">'*'</span>:</div><div class="line">            self.source_attrs = []</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.source_attrs = self.source.split(<span class="string">'.'</span>)</div></pre></td></tr></table></figure>
<p>由於經過這樣的處理，所以attrs必定是list型態，所以這邊<code>get_attribute</code>才會用for loop，其實這個function做的事情，如同他的註解說的差不多，真的就跟python內建的 <code>getattr</code> 很像，只是他可以接受nested屬性，例如： <code>obj.a.c</code> 這樣。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_default</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_empty_values</span><span class="params">(self, data)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>這兩個function就不多琢磨了，就算是helper function這樣</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_validation</span><span class="params">(self, data=empty)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	Validate a simple representation and return the internal value.</div><div class="line"></div><div class="line">	The provided data may be `empty` if no representation was included</div><div class="line">	in the input.</div><div class="line"></div><div class="line">	May raise `SkipField` if the field should not be included in the</div><div class="line">	validated data.</div><div class="line">	"""</div><div class="line">	(is_empty_value, data) = self.validate_empty_values(data)</div><div class="line">	<span class="keyword">if</span> is_empty_value:</div><div class="line">		<span class="keyword">return</span> data</div><div class="line">	value = self.to_internal_value(data)</div><div class="line">	self.run_validators(value)</div><div class="line">	<span class="keyword">return</span> value</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_validators</span><span class="params">(self, value)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	Test the given value against all the validators on the field,</div><div class="line">	and either raise a `ValidationError` or simply return.</div><div class="line">	"""</div><div class="line">	errors = []</div><div class="line">	<span class="keyword">for</span> validator <span class="keyword">in</span> self.validators:</div><div class="line">		<span class="keyword">if</span> hasattr(validator, <span class="string">'set_context'</span>):</div><div class="line">			validator.set_context(self)</div><div class="line"></div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			validator(value)</div><div class="line">		<span class="keyword">except</span> ValidationError <span class="keyword">as</span> exc:</div><div class="line">			<span class="comment"># If the validation error contains a mapping of fields to</span></div><div class="line">			<span class="comment"># errors then simply raise it immediately rather than</span></div><div class="line">			<span class="comment"># attempting to accumulate a list of errors.</span></div><div class="line">			<span class="keyword">if</span> isinstance(exc.detail, dict):</div><div class="line">				<span class="keyword">raise</span></div><div class="line">			errors.extend(exc.detail)</div><div class="line">		<span class="keyword">except</span> DjangoValidationError <span class="keyword">as</span> exc:</div><div class="line">			errors.extend(exc.messages)</div><div class="line">	<span class="keyword">if</span> errors:</div><div class="line">		<span class="keyword">raise</span> ValidationError(errors)</div></pre></td></tr></table></figure>
<p>這邊就是serializer常用到的validation了，做檢查～<br>最後值得注意的地方是下面這兩個function</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_internal_value</span><span class="params">(self, data)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	Transform the *incoming* primitive data into a native value.</div><div class="line">	"""</div><div class="line">	<span class="keyword">raise</span> NotImplementedError(</div><div class="line">		<span class="string">'&#123;cls&#125;.to_internal_value() must be implemented.'</span>.format(</div><div class="line">			cls=self.__class__.__name__</div><div class="line">		)</div><div class="line">	)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_representation</span><span class="params">(self, value)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	Transform the *outgoing* native value into primitive data.</div><div class="line">	"""</div><div class="line">	<span class="keyword">raise</span> NotImplementedError(</div><div class="line">		<span class="string">'&#123;cls&#125;.to_representation() must be implemented.\n'</span></div><div class="line">		<span class="string">'If you are upgrading from REST framework version 2 '</span></div><div class="line">		<span class="string">'you might want `ReadOnlyField`.'</span>.format(</div><div class="line">			cls=self.__class__.__name__</div><div class="line">		)</div><div class="line">	)</div></pre></td></tr></table></figure>
<p><code>to_internal_value</code> 作用就是把輸入得資料轉換成，你資料庫或者其他地方你想要儲存的型態，像是日期好了，你輸入的是字串，但是rest framework的DatetimeField，是幫你轉成python裡的datetime相關物件， 至於 <code>to_representation</code> 就是資料輸出的形式， 一般都是當你call <code>serializer.data</code> 所表現的形式就是用到上面那個function， 這裡的serializer是某某Serializer class的instance。</p>
<p>到目前為止，class Field，大致上的實作都大概看過了，這個是很重要的核心，因為你看源碼你會發現，有很多其他東西都是繼承於這個， XXXField 一堆～～</p>
<p>這篇就先紀錄到這邊為止，下一次就回到BaseSerializer那邊去理解源碼。</p>
<h6 id="tags-python-restframework"><a href="#tags-python-restframework" class="headerlink" title="tags: python restframework"></a>tags: <code>python</code> <code>restframework</code></h6>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2016/03/20/663369/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/20/663369/" itemprop="url">
                  django rest framework 小小心得
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-20T13:44:00+00:00">
                2016-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/django/" itemprop="url" rel="index">
                    <span itemprop="name">django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/03/20/663369/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/03/20/663369/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="django-rest-framework"><a href="#django-rest-framework" class="headerlink" title="django rest framework"></a>django rest framework</h1><p>這篇主要是針對於個人目前學習django rest framework的一些小小心得，在開發django而言，想要撰寫restful api，是有幾個套件可以選擇的</p>
<ul>
<li><a href="http://www.django-rest-framework.org/" target="_blank" rel="external">rest framework</a></li>
<li><a href="https://github.com/django-tastypie/django-tastypie" target="_blank" rel="external">tastypie</a></li>
</ul>
<p>主要而言是這兩個，個人是學django rest framework，tastypie個人沒啥碰所以就不做啥比較了，當然你也可以不屑使用上面這兩個，小弟有看過使用requests來實作api的 :)</p>
<p>大致上這篇會用下列的順序介紹</p>
<ul>
<li>core part</li>
<li>serializer</li>
<li>generic api</li>
<li>url router</li>
<li>some situation may bother you</li>
</ul>
<h2 id="core-part"><a href="#core-part" class="headerlink" title="core part"></a>core part</h2><p>個人覺得這套主要核心整個圍繞在<code>serializer</code>上，其他的有<code>class based views</code>的相關api，api通常會跟<code>permission</code>和<code>authentication</code>有所關聯，最後如果想要用比較generic way的方式，就要用到<code>viewset</code>和<code>router</code>。</p>
<p>這邊rest framework的<a href="http://www.django-rest-framework.org/tutorial/quickstart/" target="_blank" rel="external">quick start</a>個人覺得做了一個很簡單上手的示範，讓你先了解一些基本概念，serializer的基本使用方法，如果有看他source code，可以看到他的概念就是從django form，field那些過來的，所以會有很多類似的東西，至於serializer比較深的東西，下一個段落再來多說明。</p>
<p>quick start 後面也提到class based view的使用方式，不過他是從function based view帶到class based view，個人比較偏好class based view，可讀性更好，假如你一個function based view可接受很多http method，這樣裏面code就一定會參雜各種method的相對應code，很可能你裏面就會有向下面這樣</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@api_view(['GET', 'POST'])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">userview</span><span class="params">(request, *arg, **kwargs)</span>:</span></div><div class="line">	<span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</div><div class="line">		<span class="keyword">pass</span></div><div class="line">	<span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</div><div class="line">		<span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>沒有說那種一定好一定壞，就看客官的個人喜好囉~~</p>
<p>再來<code>request</code>和<code>response</code>在restframework都有經過額外的包裝(包裝django的response和request)這邊比較沒啥要注意的。反而是<code>authentication</code>和<code>permission</code>比較值得注意，也就是對於API進行一些存取權限的控管。有個地方需要注意的是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">permission_classes = (permissions.IsAuthenticatedOrReadOnly,</div><div class="line">                      IsOwnerOrReadOnly,)</div><div class="line"></div><div class="line">authentication_classes = (SessionAuthentication, BasicAuthentication)</div></pre></td></tr></table></figure>
<p>permission是裡面<strong>所有的permission</strong>都過了，這個request才可以執行，authentication是<strong>只要裏面有一個成功通過</strong>，那就可以執行了。</p>
<p>不信請看，rest framework源碼片斷</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># the process for checking permission</span></div><div class="line"><span class="keyword">for</span> permission <span class="keyword">in</span> self.get_permissions():</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> permission.has_permission(request, self):</div><div class="line">                self.permission_denied(</div><div class="line">                    request, message=getattr(permission, <span class="string">'message'</span>, <span class="keyword">None</span>)</div><div class="line">                )</div><div class="line"></div><div class="line"><span class="comment"># the process for checking authentication</span></div><div class="line"><span class="keyword">for</span> authenticator <span class="keyword">in</span> self.authenticators:</div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			user_auth_tuple = authenticator.authenticate(self)</div><div class="line">		<span class="keyword">except</span> exceptions.APIException:</div><div class="line">			self._not_authenticated()</div><div class="line">			<span class="keyword">raise</span></div><div class="line"></div><div class="line">		<span class="keyword">if</span> user_auth_tuple <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">			self._authenticator = authenticator</div><div class="line">			self.user, self.auth = user_auth_tuple</div><div class="line">			<span class="keyword">return</span></div></pre></td></tr></table></figure>
<p>最後的core part，就是viewset和router了，這部份就在url router那邊再多做說明。</p>
<h2 id="serializer"><a href="#serializer" class="headerlink" title="serializer"></a>serializer</h2><p>serizlier跟django的Form使用起來很像，但是這不代表它是繼承於django的form喔，有興趣的看源碼，用serializer的目的，個人是覺得把表單驗證的邏輯(舉凡參數驗證也可)從api view切開，這樣也不會讓api裏面的程式碼過於複雜。</p>
<p>一般而言大多數情況應該都是使用modelserializer，的確針對於CRUD方面確實方便，但是有時候就是會遇到當你create這個model時，會有和model對不上的欄位，進而造成錯誤發生，或是很難使用，拿個最簡單的例子，創造一個使用者，通常會需要一個email，password，password2，但是使用者model並不會有password2，畢竟那只是確認使用者密碼是不是一致。</p>
<p>對於這種情形，我是另外寫一個serializer專門為創造使用者，而且也不是用ModelSerializer，只是一般的serializer，那記得要define create的method，假如你是要用在generic viewset的create的這地方。</p>
<p>另外使用modelserializer會遇到的一種情況是，今天你想要客製化回傳的資料，比如今天你的user model裏面有一個欄位是mugshot(ImageField)，那個一般情況UserSerializer.data，那麼回傳格式通常會是希望是大概如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="string">"email"</span>: <span class="string">"aa@test.com"</span>,</div><div class="line">	<span class="string">"mugshot"</span>: <span class="string">"http://xxx.com.tw/media/.../"</span>  <span class="comment"># url 位址</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是往往天不從人願，預設可不是回傳url位址，像這種情況我目前知道的算比較OK的解法有兩種</p>
<h5 id="第1種"><a href="#第1種" class="headerlink" title="第1種"></a>第1種</h5><p>就是使用<a href="http://www.django-rest-framework.org/api-guide/fields/#serializermethodfield" target="_blank" rel="external">SerializerMethodField</a>，基本上就是建立一個readonly的field，使用方法文檔說明了很清楚，這邊我就不多說明~~</p>
<h5 id="第2種"><a href="#第2種" class="headerlink" title="第2種"></a>第2種</h5><p>就是overwride serializer的<code>to_representation</code>method，這個我是看源碼去理解出來的邪門歪道？ 不過這邊也只是跟你講講也可以用這樣的方法 :p</p>
<p>再來就是文檔的地方也有說，使用serializer時，帶入partial這個參數是可以直接partiali update或是其他的東東，這是一個不錯用的東西~~</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">serializer = CommentSerializer(comment, data=&#123;<span class="string">'content'</span>: <span class="string">u'foo bar'</span>&#125;, partial=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>最後其實剛剛上述的對於creation的用途另外寫一個專用的serializer，你也可以不要這樣寫，就全都寫在同樣的serializer上，用上面的userserializer繼續舉例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></div><div class="line">	</div><div class="line">	password2 = serializer.CharField(required=<span class="keyword">False</span>)</div><div class="line">	</div><div class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">	</div><div class="line">		model = User</div><div class="line">		fields = (<span class="string">'username'</span>, <span class="string">'email'</span>)</div></pre></td></tr></table></figure>
<p>注意～如果你password2的Field不加required的話，由於modelserializer的<code>to_representation</code>會去檢查這個field是否存在於這個model，這時就會爽快的爆掉啦～～</p>
<p>不過別以為任務就這樣結束了，根據你這個serializer的用途，接下來你就要自己去overwrite，<code>create</code>or<code>update</code>這兩個方法。會不會覺得很簡單？ 其實說真的是不難（前提你知道rest framework背後幫你搞什麼…，但是我一直在想這樣寫就變成有好多邏輯都混在這個serializer裡面～</p>
<p>目前而言，我並不清楚哪種寫法才是最好的，畢竟我碰這套framework沒有說很久，也不是核心開發者，我只是提供稍微比較tricky的方式來達到各種目的。</p>
<h2 id="generic-api"><a href="#generic-api" class="headerlink" title="generic api"></a>generic api</h2><p>generic api這是我比較最近接觸的東西，老實講一開始學這套我還真的只用rest framework的APIView打天下，api的參數驗證也自己來，其實這也好像沒啥不行xxd，只是這套framework既然提供了serializer和generic api view，就一定有他的用處，所以最近碰了一些，打算寫點東西來記錄。</p>
<p>首先來講講GenericViewSet和GenericAPIView，不~ 其實應該這樣看，在restframework的ViewSet其實都是繼承於APIView，所以看到GenericViewSet，可以知道其實這個是繼承GenericAPIView，那麼到底這兩者差在哪？ 一樣來看看源碼~ 比較仔細閱讀文檔，不如鑽研源碼搭配文檔還比較有效率，個人是這樣認為拉！ 每個人都有自己的習慣，所以不一定要照我的方法，找到屬於自己最有效率的方法才是比較重要的，話題拉回來，下面是源碼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewSet</span><span class="params">(ViewSetMixin, views.APIView)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    The base ViewSet class does not provide any actions by default.</div><div class="line">    """</div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericViewSet</span><span class="params">(ViewSetMixin, generics.GenericAPIView)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    The GenericViewSet class does not provide any actions by default,</div><div class="line">    but does include the base set of generic view behavior, such as</div><div class="line">    the `get_object` and `get_queryset` methods.</div><div class="line">    """</div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>看出什麼了嗎？他們都多了ViewSetMixin，如果懶的看源碼理解~ 其實可看他程式碼裏面的註解寫的簡單易懂，下面是註解片段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Overrides `.as_view()` so that it takes an `actions` keyword that performs</div><div class="line">    the binding of HTTP methods to actions on the Resource.</div><div class="line"></div><div class="line">    For example, to create a concrete view binding the &apos;GET&apos; and &apos;POST&apos; methods</div><div class="line">    to the &apos;list&apos; and &apos;create&apos; actions...</div><div class="line"></div><div class="line">    view = MyViewSet.as_view(&#123;&apos;get&apos;: &apos;list&apos;, &apos;post&apos;: &apos;create&apos;&#125;)</div></pre></td></tr></table></figure>
<p>應該不需要多解釋了吧？ 再來主要需要理解的是 APIView和GenericAPIView這兩個做了什麼，這邊就不再貼源碼，直接做個大綱的介紹，應該說個人的理解 :P</p>
<p>由於GenericAPIView是繼承APIView，所以就先來看看APIView實際上到底做了什麼，若你很常用class based view，其實這你應該常碰到，這個我本人也沒深入研究（掩面，但是大致上是做了authentication和permission以及dispatch（url router相關），還有一些和browserable api render相關等等的處理，這個就不多說了，畢竟源碼我沒什麼讀。</p>
<p>GenericAPIView比起剛剛那些多了</p>
<ul>
<li>get_queryset</li>
<li>get_object</li>
<li>get_serializer</li>
<li>filter_queryset</li>
<li>….</li>
</ul>
<p>很明顯開始跟serializer之間關聯性越來越高，因此ModelViewSet也是繼承這個去實作額外的動作 :) GenericAPIView有幾個地方值得注意，因為根據你的case，你應該會很容易發現到，你會想要客製化某些功能，因為你的case並沒有那麼generic～～</p>
<p>最常會overwrite的function應該是<code>get_serializer_class</code>，這通常是CRUD中，你特別寫了C的serializer，R也一個，甚至U也一個，所以這時候需要判斷不同http method或是action去使用不同的serializer。</p>
<ul>
<li><code>get_queryset</code></li>
<li><code>get_object</code></li>
</ul>
<p>這兩個你也有可能會想覆寫～</p>
<p>最後一個心得，關於這邊的使用方式，與其去讀文檔，直接來讀source code更容易理解，給各位客官參考</p>
<h2 id="url-router"><a href="#url-router" class="headerlink" title="url router"></a>url router</h2><p>Routers，這個東東，老實講我並沒有覺得好用，而且綁得很死，Routers是跟ModelViewSet綁在一起的，她做的事情其實也只是幫你自動產生你常寫的urlpattern。</p>
<p>所以所以，我個人目前不知道這個有很好用？ 仔細想想，今天假如你要用一個nested router的效果，但是你的第二層，卻只是單單onetoone，這樣url後面還需要帶參數(id)嗎？</p>
<p>ex.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">http://example.com/api/users/<span class="number">5</span>/profile/&lt;pk&gt;/  <span class="comment"># 後面還需要？</span></div><div class="line">http://example.com/api/users/<span class="number">5</span>/profile/       <span class="comment"># 應該只要這樣就好了吧</span></div></pre></td></tr></table></figure>
<p>這個問題，是我在用nested router套件時發現的，沒錯<strong>套件</strong>，你沒看錯，內建是沒有支援nested的….</p>
<p>因此，我個人推薦urlpattern這邊還是自己動手寫吧，自由度相對大很多，而且別人要trace你的code，也變得比較容易，要不然你都用register，沒辦法一眼看出，那個url是對應到哪個view～</p>
<p>最後如果有人知道Router其實可以變得好用，也請教教我xxd</p>
<h2 id="some-situation-may-bother-you"><a href="#some-situation-may-bother-you" class="headerlink" title="some situation may bother you"></a>some situation may bother you</h2><p>這邊阿～～～ 其實前面在講各個觀念時，也大概都提了一些可能會遇到的卡點，所以這邊大概是小小結論我仍然覺得疑惑的地方，</p>
<p>第一點，serializer到底是只要純負責關於CRUD的處理判斷邏輯就好？ 還是說對於api的參數處理，我都應該要實作一個serializer去對應？ 這個是指有些api並沒有對model做CRUD，但是卻也有相對應的動作，比如要驗證手機時，獲取驗證碼（GET)，驗證你拿到的驗證碼（POST? PATCH?)，這些動作也一定會有參數需要驗證吧，但是我目前還不知道把邏輯放在哪邊比較好～～ 也不知道有在用rest framework的各位寫程式時，有沒有一樣的煩惱</p>
<p>第二點，就是該用哪種http method去對應動作，通常是對於非CRUD，可能會猶豫一下該用哪種http method，url的配置要怎麼配置，前面router說不想用也是這個原因，router把你綁死，萬一你遇到奇怪神奇的要求，你就好笑了，但是這個還好，看各家公司想要怎麼做吧～～</p>
<p>第三點，想要直接全域客製化api回傳格式，這是最近我遇到的要求，解法也在這邊提供一下，<a href="http://www.django-rest-framework.org/api-guide/exceptions/" target="_blank" rel="external">根據文檔</a>，自己寫一個APIException handler，處理成你想要的格式即可。</p>
<p>最後，就是這套framework是需要時間熟悉的xd 想要一看就上手恐怕有點難，除非你本來django就熟到爆炸，那這套framework你應該會很快上手，畢竟有一些概念時來自django的。</p>
<h6 id="tags-python-restful-api-django"><a href="#tags-python-restful-api-django" class="headerlink" title="tags: python restful api django"></a>tags: <code>python</code> <code>restful api</code> <code>django</code></h6>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sillygod.github.io/2015/07/11/direction-bit-slippery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Travel in Programming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/11/direction-bit-slippery/" itemprop="url">
                  方向有點捉摸不定
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-11T13:06:00+00:00">
                2015-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/miscellaneous/" itemprop="url" rel="index">
                    <span itemprop="name">miscellaneous</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/07/11/direction-bit-slippery/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/07/11/direction-bit-slippery/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>已經有幾個月沒寫blog，有一半的原因是新公司，事情太多了，讓我下班後沒力氣寫blog，連假日都想好好的休息阿 :(  這篇大概是個抒發隨手寫寫的文章吧XD</p>
<p>現在我在這家公司，已經變得有點<strong>full stack</strong>了，雖然我的職稱是網站後端工程師，但是卻包辦前端css和angularJS，雖然我是略懂前端，只是要我像那些專精於前端，那麼會調校前端的細節處理，實在是強人所難~~  我目前的工作是用<strong>django</strong>和<strong>angularjs</strong>來寫網站，其實還稍微包辦，server的處理…不過幸好沒有要用到nginx的一些設置，只要會架就好…</p>
<p>踩了兩家新創公司，其實讓我有個想法，恐怕台灣純軟新創應該幾乎都是雷了，要不然就是我不會挑公司和談薪水吧?，在新創公司說好聽點是可以學很多東西~~ 但是事實就是你要負責比別人多事情，要會的東西也要多，但是薪水就相對..恩你懂得。其實最近我一直在想</p>
<ul>
<li>我到底是要什麼樣的未來</li>
<li>我想要什麼樣的能力</li>
<li>我想要創造什麼東西</li>
</ul>
<p>我對於很多東西其實沒有特別排斥，唯有嵌入式…不知道為什麼聽到就不想碰~ 其實公司要我寫前端，我沒特別排斥，反正我也藉機會可以稍微增強自己的前端實力，只是我時常在想希望時間可以過慢點，這樣我才可以短時間將很多東西都學起來 :)  哈! 總感覺自己好像有點貪婪，想要什麼東西都會 :)</p>
<p>但是這樣好像是不太好的? 因為好像沒有人是真的可以<strong>樣樣精通</strong>，如果是天才就算了? 很常看到一句話<code>什麼都會一點，但樣樣都不精通</code> 但是如果是 <code>什麼都是中等或是中高呢</code> ? 大家都是選擇只往某條路一直走下去，但是有確定那條路就是你真的想要的? 或是適合你發揮的? 或許有人就是可以樣樣都算是中等以上，就算是在某領域要到精通其實也頗難吧，有多少人自己為精通，其實…恩這就不多談~ 其實我當初以為早點出社會可以讓我心中的方向更明確點，但事實上我反而更亂了XD 因為越往programming方向走，越發現programming的無限可能性，可以說是生活中的一切都跟程式有關。</p>
<p>但是我唯一確定的是我想要用程式創造一個讓我自豪的東西，這是十分肯定的! 雖然現階段我還不知道我想要創造什麼，所以目前我也只能像一頭牛狂奔，與其在原地轉圈圈，不如恣意的亂衝吧~ 或許我喜歡的就是<strong>路途中的所見所聞</strong>而不是到<strong>達終點的喜悅</strong>也說不定 :)</p>
<p>哈! 這篇寫得雜亂無章，就只是一個抒發文和熱身文吧? 至少目前我想要稍微精進自己CSS和JS，下次來發篇跟這些相關的程式心得文。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://www.gravatar.com/avatar/83f18dfd754f801352a9c1ee3df77c36.jpg?s=150"
               alt="jing" />
          <p class="site-author-name" itemprop="name">jing</p>
           
              <p class="site-description motion-element" itemprop="description">I am a web developer. love python, know js, css, html and learn haskell in spare time.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">60</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sillygod" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/disciple.starry" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jing</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://mytravelinprogramming.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
